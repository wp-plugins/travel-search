TGSB_WindowOpener=function(a){if(top!=self){try{if(top.document.location.toString()){this._top=top}}catch(err){}}this.opts={popUnder:false,maxScreenWidth:1280,maxScreenHeight:1024,minWinWidth:0,minWinHeight:0,winWidth:600,winHeight:700,style:'cascade',heightRatio:null,sendPosition:false,position:{left:0,top:0,width:100,height:100},chromePPBmode:false,blankPageHtml:"<h4 style='text-align:center;'>Please wait...</h4>",useHover:false};this.windowCache={};this.allWindowNames={};for(var i in a)this.opts[i]=a[i]};TGSB_WindowOpener.prototype={_top:self,open:function(a,b,c,d,e){if(!a)return true;var f=this._isWindowOpen(b);var g='';if(!f){g=this._normalizeWindowName(b);g=this._getUniqueWinName(g)}var i=this._openWindow(a,f||g,c,d,e);if(!i)return false;if(b){if(f){delete this.windowCache[b]}else{this.windowCache[b]=i}}if(!this.opts.popUnder){this._focusWindow(i);return i}this._blurWindow(i);this._extendPopUpWindow(i);try{i.sendFocus2Parent(i)}catch(h){};return i},_normalizeWindowName:function(a){return a&&a.replace(/[^a-zA-Z0-9_]+/,'')},_changeBlankWindowLocation:function(a,b,t,l,w,h){if(!a||typeof(a)!='object')return false;try{a.resizeTo(w,h)}catch(err){}try{a.moveTo(l,t)}catch(err){}if(this.opts.sendPosition)b=this._addPos2Url(b,t,l,w,h);a.location=b;return true},_changeWindowLocation:function(a,b){if(!a||typeof(a)!='object')return false;a.document.open();a.document.write("<html><head>");a.document.write('<script type="text/javascript">\n');a.document.write('window.location="'+b+'";');a.document.write("<\/script>\n");a.document.write("</head><body></body></html>");a.document.close();return true},_populateBlankPage:function(a){if(!a||typeof(a)!='object')return false;a.document.open();a.document.write("<html><head>");a.document.write("<title>Please wait</title>");a.document.write("</head><body style='padding:0;margin:0;'>");if(this.opts.blankPageHtml&&typeof(this.opts.blankPageHtml)=='string')a.document.write(this.opts.blankPageHtml);a.document.write("</body></html>");a.document.close()},_openWindow:function(b,c,d,e,f){var t=this._newWinTop(d,e);var l=this._newWinLeft(d,e);var w=this._newWinWidth(d,e);var h=this._newWinHeight(d,e);if(c&&typeof c=='object'){this._changeBlankWindowLocation(c,b,t,l,w,h);return c}var g=this.opts.style=='tab'?'':'toolbar=0,scrollbars=1,location=1,statusbar=1,menubar=0,resizable=1'+',top='+t+',left='+l+',width='+w+',height='+h;try{if(!this.opts.chromePPBmode||f){var w=this._top.window.open(b,c,g);if(b=='about:blank')this._populateBlankPage(w);return w};this._top.window.open("javascript:window.blur()","_top","");var w=this._top.window.open('about:blank',c,g);if(b=='about:blank')this._populateBlankPage(w);else this._changeWindowLocation(w,b);return w}catch(a){return false}},_newWinTop:function(a,b){if(this.opts.style=='fix')return this.opts.position.top;if(this.opts.heightRatio!==null){return Math.round(this._maxScreenHeight()*(1-this.opts.heightRatio))}if(this.opts.style=='side'){return 0}if(this.opts.style=='cascade'){return a*Math.floor((this._maxScreenHeight()-this.opts.winHeight)/b)}if(typeof this._top.window.screenTop!='undefined'){return this._top.window.screenTop}return this._top.window.screenY},_newWinLeft:function(a,b){if(this.opts.style=='fix')return this.opts.position.left;if(this.opts.style=='side'){return Math.floor(this._newWinWidth(a,b)*a)}if(this.opts.style=='cascade'){return a*Math.floor((this._maxScreenWidth()-this.opts.winWidth)/b)}if(typeof this._top.window.screenLeft!='undefined'){return this._top.window.screenLeft}return this._top.window.screenX},_newWinWidth:function(a,b){if(this.opts.style=='fix')return this.opts.position.width;if(this.opts.style=='side'){return Math.min(this.opts.maxScreenWidth,Math.floor(this._maxScreenWidth()/b-10))}if(this.opts.style=='cascade'){return this.opts.winWidth}var c=this._topWinWidth();if(this.opts.minWinWidth){return Math.max(this.opts.minWinWidth,c)}return c},_newWinHeight:function(){if(this.opts.style=='fix')return this.opts.position.height;if(this.opts.heightRatio!==null){return Math.round(this._maxScreenHeight()*this.opts.heightRatio)}if(this.opts.style=='side'){return this._maxScreenHeight()}if(this.opts.style=='cascade'){return this.opts.winHeight}var a=this._topWinHeight();if(this.opts.minWinHeight){return Math.max(this.opts.minWinHeight,a)}return a},_topWinHeight:function(){if(typeof(this._top.window.innerHeight)=='number'){return this._top.window.innerHeight}if(this._top.document.documentElement&&this._top.document.documentElement.clientHeight){return this._top.document.documentElement.clientHeight}if(this._top.document.body&&this._top.document.body.clientHeight){return this._top.document.body.clientHeight}return 0},_topWinWidth:function(){if(typeof(this._top.window.innerWidth)=='number'){return this._top.window.innerWidth}if(this._top.document.documentElement&&this._top.document.documentElement.clientWidth){return this._top.document.documentElement.clientWidth}if(this._top.document.body&&this._top.document.body.clientWidth){return this._top.document.body.clientWidth}return 0},_maxScreenWidth:function(){if(window.screen.availWidth){return window.screen.availWidth<this.opts.maxScreenWidth?window.screen.availWidth:this.opts.maxScreenWidth}return this.opts.maxScreenWidth},_maxScreenHeight:function(){if(window.screen.availHeight){return window.screen.availHeight<this.opts.maxScreenHeight?window.screen.availHeight:this.opts.maxScreenHeight}return this.opts.maxScreenHeight},_addPos2Url:function(a,t,l,w,h){if(!a)return a;var b=a.indexOf('?')=='-1'?'?':'&';return a+=b+'resizeTo[t]='+t+'&resizeTo[l]='+l+'&resizeTo[w]='+w+'&resizeTo[h]='+h},_blurWindow:function(a){a.blur();if(navigator.userAgent.toLowerCase().indexOf("applewebkit")>-1){this._top.window.blur();this._top.window.focus()}},_focusWindow:function(a){a.focus()},_extendPopUpWindow:function(a){var d={sendFocus2Parent:function(b){this._handleMozzEngine();try{b.opener.window.focus()}catch(c){}},_handleMozzEngine:function(){if(typeof window.mozPaintCount!=="undefined"||typeof navigator.webkitGetUserMedia==="function"){var b=this.window.open("about:blank");b.close()}}};try{for(var i in d)a[i]=d[i]}catch(e){}},setOptions:function(a){for(var i in a)this.opts[i]=a[i]},_getUniqueWinName:function(a){if(!a)return a;for(var i=0;this.allWindowNames[a+i];i++);this.allWindowNames[a+i]=1;return a+i},close:function(a){if(!this.windowCache[a])return false;try{this.windowCache[a].close()}catch(err){};delete(this.windowCache[a]);return true},_isWindowOpen:function(a){return a&&this.windowCache[a]&&!this.windowCache[a].closed&&this.windowCache[a]},wrapButton:function(b,c){if(!this.opts.chromePPBmode||!b)return false;if(typeof(jQuery)=='undefined'&&typeof(b.click)!='function'&&typeof(b.onclick)!='function')return false;var d=this._top.document.createElement('span');var f=d.style;f.display="inline-block";f.position="relative";f.width="auto";f.height="auto";f.margin="0px";f.marginBottom="0px";f.marginTop="0px";f.marginLeft="0px";f.marginRight="0px";d.className="ppupHandlerCont";var g=this._top.document.createElement('iframe');var h=g.style;var i=b.style;g.frameBorder="0";g.src="about:blank";h.border="none";h.cursor="pointer";h.position="absolute";h.top="0";h.left="0";if(b.width==c||!b.width||b.width=="0"||b.height==c||!b.height||b.height=="0"){g.width="100%";g.height="100%";h.padding="0px";h.margin="0px"}else{g.width=b.width;g.height=b.height;h.padding=i.padding;h.paddingTop=i.paddingTop;h.paddingRight=i.paddingRight;h.paddingBottom=i.paddingBottom;h.paddingLeft=i.paddingLeft;h.margin=i.margin;h.marginTop=i.marginTop;h.marginRight=i.marginRight;h.marginBottom=i.marginBottom;h.marginLeft=i.marginLeft};var j=this;var k=function(){var a;if(g.contentDocument)a=g.contentDocument;else if(g.contentWindow&&g.contentWindow.document)a=g.contentWindow.document;else return;a.body.style.margin="0";a.body.style.cursor="pointer";a.onclick=function(e){if(typeof(b.click)=='function')b.click();else if(typeof(jQuery)!='undefined')jQuery(b).click();else if(typeof(b.onclick)=='function')b.onclick()};if(j.opts.useHover){a.onmouseover=function(){var n=b.className.replace(/\bwindowOpener_mouseOver\b/g,'');b.className=(n+' windowOpener_mouseOver').replace(/ +/,' ').replace(/^ | $/g,'')};a.onmouseout=function(){var n=b.className.replace(/\bwindowOpener_mouseOver\b/g,'');b.className=n.replace(/ +/g,' ').replace(/^ | $/g,'')}}};g.onload=k;b.parentNode.insertBefore(d,b);d.appendChild(b);d.appendChild(g);return g}};
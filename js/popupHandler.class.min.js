/*deleteCache-description:JS file for the window management inside the WP Travel Search plugin*/
/*deleteCache-minimizeJS:true*/
TGSB_WindowOpener=function(opts){if(top!=self){try{if(top.document.location.toString()){this._top=top}}catch(err){}}this.opts={popUnder:false,maxScreenWidth:1280,maxScreenHeight:1024,minWinWidth:0,minWinHeight:0,winWidth:600,winHeight:700,style:'cascade',heightRatio:null,sendPosition:false,position:{left:0,top:0,width:100,height:100},chromePPBmode:false,blankPageHtml:"<h4 style='text-align:center;'>Please wait...</h4>",useHover:false};this.windowCache={};this.allWindowNames={};for(var i in opts)this.opts[i]=opts[i]};TGSB_WindowOpener.prototype={_top:self,open:function(url,wName,wIndex,totalWinCount,isSingle){if(!url)return true;var alreadyOpenedWin=this._isWindowOpen(wName);var formattedWinName='';if(!alreadyOpenedWin){formattedWinName=this._normalizeWindowName(wName);formattedWinName=this._getUniqueWinName(formattedWinName)}var wnd=this._openWindow(url,alreadyOpenedWin||formattedWinName,wIndex,totalWinCount,isSingle);if(!wnd)return false;if(wName){if(alreadyOpenedWin){delete this.windowCache[wName]}else{this.windowCache[wName]=wnd}}if(!this.opts.popUnder){this._focusWindow(wnd);return wnd}this._blurWindow(wnd);this._extendPopUpWindow(wnd);try{wnd.sendFocus2Parent(wnd)}catch(h){};return wnd},_normalizeWindowName:function(wName){return wName&&wName.replace(/[^a-zA-Z0-9_]+/,'')},_changeBlankWindowLocation:function(windowObj,url,t,l,w,h){if(!windowObj||typeof(windowObj)!='object')return false;try{windowObj.resizeTo(w,h)}catch(err){}try{windowObj.moveTo(l,t)}catch(err){}if(this.opts.sendPosition)url=this._addPos2Url(url,t,l,w,h);windowObj.location=url;return true},_changeWindowLocation:function(wnd,url){if(!wnd||typeof(wnd)!='object')return false;wnd.document.open();wnd.document.write("<html><head>");wnd.document.write('<script type="text/javascript">\n');wnd.document.write('window.location="'+url+'";');wnd.document.write("<\/script>\n");wnd.document.write("</head><body></body></html>");wnd.document.close();return true},_populateBlankPage:function(wnd){if(!wnd||typeof(wnd)!='object')return false;wnd.document.open();wnd.document.write("<html><head>");wnd.document.write("<title>Please wait</title>");wnd.document.write("</head><body style='padding:0;margin:0;'>");if(this.opts.blankPageHtml&&typeof(this.opts.blankPageHtml)=='string')wnd.document.write(this.opts.blankPageHtml);wnd.document.write("</body></html>");wnd.document.close()},_openWindow:function(url,wNameOrObj,wIndex,totalWinCount,isSingle){var t=this._newWinTop(wIndex,totalWinCount);var l=this._newWinLeft(wIndex,totalWinCount);var w=this._newWinWidth(wIndex,totalWinCount);var h=this._newWinHeight(wIndex,totalWinCount);if(wNameOrObj&&typeof wNameOrObj=='object'){this._changeBlankWindowLocation(wNameOrObj,url,t,l,w,h);return wNameOrObj}var params=this.opts.style=='tab'?'':'toolbar=0,scrollbars=1,location=1,statusbar=1,menubar=0,resizable=1'+',top='+t+',left='+l+',width='+w+',height='+h;try{if(!this.opts.chromePPBmode||isSingle){var w=this._top.window.open(url,wNameOrObj,params);if(url=='about:blank')this._populateBlankPage(w);return w};this._top.window.open("javascript:window.blur()","_top","");var w=this._top.window.open('about:blank',wNameOrObj,params);if(url=='about:blank')this._populateBlankPage(w);else this._changeWindowLocation(w,url);return w}catch(a){return false}},_newWinTop:function(wIndex,totalWinCount){if(this.opts.style=='fix')return this.opts.position.top;if(this.opts.heightRatio!==null){return Math.round(this._maxScreenHeight()*(1-this.opts.heightRatio))}if(this.opts.style=='side'){return 0}if(this.opts.style=='cascade'){return wIndex*Math.floor((this._maxScreenHeight()-this.opts.winHeight)/totalWinCount)}if(typeof this._top.window.screenTop!='undefined'){return this._top.window.screenTop}return this._top.window.screenY},_newWinLeft:function(wIndex,totalWinCount){if(this.opts.style=='fix')return this.opts.position.left;if(this.opts.style=='side'){return Math.floor(this._newWinWidth(wIndex,totalWinCount)*wIndex)}if(this.opts.style=='cascade'){return wIndex*Math.floor((this._maxScreenWidth()-this.opts.winWidth)/totalWinCount)}if(typeof this._top.window.screenLeft!='undefined'){return this._top.window.screenLeft}return this._top.window.screenX},_newWinWidth:function(wIndex,totalWinCount){if(this.opts.style=='fix')return this.opts.position.width;if(this.opts.style=='side'){return Math.min(this.opts.maxScreenWidth,Math.floor(this._maxScreenWidth()/totalWinCount-10))}if(this.opts.style=='cascade'){return this.opts.winWidth}var topWinWidth=this._topWinWidth();if(this.opts.minWinWidth){return Math.max(this.opts.minWinWidth,topWinWidth)}return topWinWidth},_newWinHeight:function(){if(this.opts.style=='fix')return this.opts.position.height;if(this.opts.heightRatio!==null){return Math.round(this._maxScreenHeight()*this.opts.heightRatio)}if(this.opts.style=='side'){return this._maxScreenHeight()}if(this.opts.style=='cascade'){return this.opts.winHeight}var topWinHeight=this._topWinHeight();if(this.opts.minWinHeight){return Math.max(this.opts.minWinHeight,topWinHeight)}return topWinHeight},_topWinHeight:function(){if(typeof(this._top.window.innerHeight)=='number'){return this._top.window.innerHeight}if(this._top.document.documentElement&&this._top.document.documentElement.clientHeight){return this._top.document.documentElement.clientHeight}if(this._top.document.body&&this._top.document.body.clientHeight){return this._top.document.body.clientHeight}return 0},_topWinWidth:function(){if(typeof(this._top.window.innerWidth)=='number'){return this._top.window.innerWidth}if(this._top.document.documentElement&&this._top.document.documentElement.clientWidth){return this._top.document.documentElement.clientWidth}if(this._top.document.body&&this._top.document.body.clientWidth){return this._top.document.body.clientWidth}return 0},_maxScreenWidth:function(){if(window.screen.availWidth){return window.screen.availWidth<this.opts.maxScreenWidth?window.screen.availWidth:this.opts.maxScreenWidth}return this.opts.maxScreenWidth},_maxScreenHeight:function(){if(window.screen.availHeight){return window.screen.availHeight<this.opts.maxScreenHeight?window.screen.availHeight:this.opts.maxScreenHeight}return this.opts.maxScreenHeight},_addPos2Url:function(url,t,l,w,h){if(!url)return url;var separator=url.indexOf('?')=='-1'?'?':'&';return url+=separator+'resizeTo[t]='+t+'&resizeTo[l]='+l+'&resizeTo[w]='+w+'&resizeTo[h]='+h},_blurWindow:function(wnd){wnd.blur();if(navigator.userAgent.toLowerCase().indexOf("applewebkit")>-1){this._top.window.blur();this._top.window.focus()}},_focusWindow:function(wnd){wnd.focus()},_extendPopUpWindow:function(WINwindow){var newWinObj={sendFocus2Parent:function(b){this._handleMozzEngine();try{b.opener.window.focus()}catch(c){}},_handleMozzEngine:function(){if(typeof window.mozPaintCount!=="undefined"||typeof navigator.webkitGetUserMedia==="function"){var b=this.window.open("about:blank");b.close()}}};try{for(var i in newWinObj)WINwindow[i]=newWinObj[i]}catch(e){}},setOptions:function(opts){for(var i in opts)this.opts[i]=opts[i]},_getUniqueWinName:function(wName){if(!wName)return wName;for(var i=0;this.allWindowNames[wName+i];i++);this.allWindowNames[wName+i]=1;return wName+i},close:function(wName){if(!this.windowCache[wName])return false;try{this.windowCache[wName].close()}catch(err){};delete(this.windowCache[wName]);return true},_isWindowOpen:function(wName){return wName&&this.windowCache[wName]&&!this.windowCache[wName].closed&&this.windowCache[wName]},wrapButton:function(sButton,undefined){if(!this.opts.chromePPBmode||!sButton)return false;if(typeof(jQuery)=='undefined'&&typeof(sButton.click)!='function'&&typeof(sButton.onclick)!='function')return false;var span=this._top.document.createElement('span');var sStyle=span.style;sStyle.display="inline-block";sStyle.position="relative";sStyle.width="auto";sStyle.height="auto";sStyle.margin="0px";sStyle.marginBottom="0px";sStyle.marginTop="0px";sStyle.marginLeft="0px";sStyle.marginRight="0px";span.className="ppupHandlerCont";var iframe=this._top.document.createElement('iframe');var iStyle=iframe.style;var bStyle=sButton.style;iframe.frameBorder="0";iframe.src="about:blank";iStyle.border="none";iStyle.cursor="pointer";iStyle.position="absolute";iStyle.top="0";iStyle.left="0";if(sButton.width==undefined||!sButton.width||sButton.width=="0"||sButton.height==undefined||!sButton.height||sButton.height=="0"){iframe.width="100%";iframe.height="100%";iStyle.padding="0px";iStyle.margin="0px"}else{iframe.width=sButton.width;iframe.height=sButton.height;iStyle.padding=bStyle.padding;iStyle.paddingTop=bStyle.paddingTop;iStyle.paddingRight=bStyle.paddingRight;iStyle.paddingBottom=bStyle.paddingBottom;iStyle.paddingLeft=bStyle.paddingLeft;iStyle.margin=bStyle.margin;iStyle.marginTop=bStyle.marginTop;iStyle.marginRight=bStyle.marginRight;iStyle.marginBottom=bStyle.marginBottom;iStyle.marginLeft=bStyle.marginLeft};var self=this;var iFrameOnLoad=function(){var contentDoc;if(iframe.contentDocument)contentDoc=iframe.contentDocument;else if(iframe.contentWindow&&iframe.contentWindow.document)contentDoc=iframe.contentWindow.document;else return;contentDoc.body.style.margin="0";contentDoc.body.style.cursor="pointer";contentDoc.onclick=function(e){if(typeof(sButton.click)=='function')sButton.click();else if(typeof(jQuery)!='undefined')jQuery(sButton).click();else if(typeof(sButton.onclick)=='function')sButton.onclick()};if(self.opts.useHover){contentDoc.onmouseover=function(){var n=sButton.className.replace(/\bwindowOpener_mouseOver\b/g,'');sButton.className=(n+' windowOpener_mouseOver').replace(/ +/,' ').replace(/^ | $/g,'')};contentDoc.onmouseout=function(){var n=sButton.className.replace(/\bwindowOpener_mouseOver\b/g,'');sButton.className=n.replace(/ +/g,' ').replace(/^ | $/g,'')}}};iframe.onload=iFrameOnLoad;sButton.parentNode.insertBefore(span,sButton);span.appendChild(sButton);span.appendChild(iframe);return iframe}};
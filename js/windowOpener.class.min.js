TGSB_WindowOpener=function(a){this._top=self;if(top!=self)try{top.document.location.toString()&&(this._top=top)}catch(b){}this.opts={popUnder:!1,maxScreenWidth:screen.width,maxScreenHeight:screen.height,minWinWidth:0,minWinHeight:0,winWidth:parseInt(.8*screen.width),winHeight:parseInt(.8*screen.height),style:"cascade",heightRatio:null,sendPosition:!1,position:{left:0,top:0,width:100,height:100},chromePPBmode:!1,buildPlaceHolderUrl:function(a){},buildPlaceHolderHtml:function(a){},buildWindowName:function(a){}};
this.windowCache={};this.allWindowNames={};for(var c in a)this.opts[c]=a[c];this.guid=Math.random().toString(36).substr(2,5)};
TGSB_WindowOpener.prototype={open:function(a,b,c,d){if(!a)return!0;b="function"==typeof this.opts.buildWindowName?this.opts.buildWindowName(b):!1;var e=this._isWindowOpen(b)||this._getUniqueWinName(b);a=this._openWindow(a,e,c,d);if(!a)return!1;b&&this.windowCache[b]&&delete this.windowCache[b];return a},openPlaceholder:function(a){if(!a)return!1;var b="function"==typeof this.opts.buildPlaceHolderUrl?this.opts.buildPlaceHolderUrl(a):!1,c="function"==typeof this.opts.buildPlaceHolderHtml?this.opts.buildPlaceHolderHtml(a):
!1;a="function"==typeof this.opts.buildWindowName?this.opts.buildWindowName(a):!1;b||(b="about:blank");var d=this._getUniqueWinName(a),d=this.opts.chromePPBmode?this._openChromePlaceholder(d,b,c):this._openDefaultPlaceholder(d,b,c);if(!d)return!1;"about:blank"==b&&this._populateBlankPage(d,c);return this.windowCache[a]=d},closePlaceholder:function(a){if(!a)return!1;a="function"==typeof this.opts.buildWindowName?this.opts.buildWindowName(a):!1;if(!this.windowCache[a])return!1;try{this.windowCache[a].close()}catch(b){}delete this.windowCache[a];
return!0},setOptions:function(a){for(var b in a)this.opts[b]=a[b]},isChromeMinVer:function(a){return a&&"undefined"!=typeof window.chrome?parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10)>=parseInt(a)?!0:!1:!1},_openWindow:function(a,b,c,d){var e=this._newWinTop(c,d),f=this._newWinLeft(c,d),g=this._newWinWidth(c,d);c=this._newWinHeight(c,d);if(b&&"object"==typeof b)return this._changeWindowLocation(b,a,e,f,g,c);if(this.opts.chromePPBmode)return this._openChromePopup(a,b);wnd=this._openDefaultPopup(a,
b,e,f,g,c);this.opts.popUnder?this._blurWindow(wnd):this._focusWindow(wnd);return wnd},_openChromePopup:function(a,b){if(!a)return!1;b||(b=this._generateWindowName());if(this.isChromeMinVer(30)){var c=this.opts.popUnder?"tab":"focusedtab";this._openWithClickTrigger("about:blank",c,b);return window.open(a,b)}c="window";if("tab"==this.opts.style||this.opts.popUnder)c=this.opts.popUnder?"tab":"focusedtab";this._openWithClickTrigger(a,c);return!0},_openDefaultPopup:function(a,b,c,d,e,f){if(!a)return!1;
c="tab"==this.opts.style?"":"toolbar=0,scrollbars=1,location=1,statusbar=1,menubar=0,resizable=1,top="+c+",left="+d+",width="+e+",height="+f;try{return this._top.window.open(a,b,c)}catch(g){return!1}},_normalizeWindowName:function(a){return a&&a.replace(/[^a-zA-Z0-9_]+/,"")},_changeWindowLocation:function(a,b,c,d,e,f){if(!a||"object"!=typeof a)return!1;try{a.resizeTo(e,f)}catch(g){}try{a.moveTo(d,c)}catch(h){}this.opts.sendPosition&&(b=this._addPos2Url(b,c,d,e,f));this.opts.popUnder?a.location=b:
(a=this._top.open(b,a.name),this._focusWindow(a));return a},_populateBlankPage:function(a,b){if(!a||"object"!=typeof a||!b)return!1;a.document.open();a.document.write(b);a.document.close()},_newWinTop:function(a,b){return"fix"==this.opts.style?this.opts.position.top:null!==this.opts.heightRatio?Math.round(this._maxScreenHeight()*(1-this.opts.heightRatio)):"side"==this.opts.style?0:"cascade"==this.opts.style?a*Math.floor((this._maxScreenHeight()-this.opts.winHeight)/b):"undefined"!=typeof this._top.window.screenTop?
this._top.window.screenTop:this._top.window.screenY},_newWinLeft:function(a,b){return"fix"==this.opts.style?this.opts.position.left:"side"==this.opts.style?Math.floor(this._newWinWidth(a,b)*a):"cascade"==this.opts.style?a*Math.floor((this._maxScreenWidth()-this.opts.winWidth)/b):"undefined"!=typeof this._top.window.screenLeft?this._top.window.screenLeft:this._top.window.screenX},_newWinWidth:function(a,b){if("fix"==this.opts.style)return this.opts.position.width;if("side"==this.opts.style)return Math.min(this.opts.maxScreenWidth,
Math.floor(this._maxScreenWidth()/b-10));if("cascade"==this.opts.style)return this.opts.winWidth;var c=this._topWinWidth();return this.opts.minWinWidth?Math.max(this.opts.minWinWidth,c):c},_newWinHeight:function(){if("fix"==this.opts.style)return this.opts.position.height;if(null!==this.opts.heightRatio)return Math.round(this._maxScreenHeight()*this.opts.heightRatio);if("side"==this.opts.style)return this._maxScreenHeight();if("cascade"==this.opts.style)return this.opts.winHeight;var a=this._topWinHeight();
return this.opts.minWinHeight?Math.max(this.opts.minWinHeight,a):a},_topWinHeight:function(){return"number"==typeof this._top.window.innerHeight?this._top.window.innerHeight:this._top.document.documentElement&&this._top.document.documentElement.clientHeight?this._top.document.documentElement.clientHeight:this._top.document.body&&this._top.document.body.clientHeight?this._top.document.body.clientHeight:0},_topWinWidth:function(){return"number"==typeof this._top.window.innerWidth?this._top.window.innerWidth:
this._top.document.documentElement&&this._top.document.documentElement.clientWidth?this._top.document.documentElement.clientWidth:this._top.document.body&&this._top.document.body.clientWidth?this._top.document.body.clientWidth:0},_maxScreenWidth:function(){return window.screen.availWidth?window.screen.availWidth<this.opts.maxScreenWidth?window.screen.availWidth:this.opts.maxScreenWidth:this.opts.maxScreenWidth},_maxScreenHeight:function(){return window.screen.availHeight?window.screen.availHeight<
this.opts.maxScreenHeight?window.screen.availHeight:this.opts.maxScreenHeight:this.opts.maxScreenHeight},_addPos2Url:function(a,b,c,d,e){if(!a)return!1;var f="-1"==a.indexOf("?")?"?":"&";return a+(f+"resizeTo[t]="+b+"&resizeTo[l]="+c+"&resizeTo[w]="+d+"&resizeTo[h]="+e)},_blurWindow:function(a){if("object"!=typeof a)return!1;a.blur();-1<navigator.userAgent.toLowerCase().indexOf("applewebkit")&&this._top.window.blur();this._top.window.focus();this._extendPopUpWindow(a);try{a.sendFocus2Parent(a)}catch(b){}try{this._top.window.open("javascript:window.focus();",
"_self")}catch(c){}return!0},_focusWindow:function(a){a&&a.focus&&a.focus()},_extendPopUpWindow:function(a){var b={sendFocus2Parent:function(a){this._handleMozzEngine();try{a.opener.window.focus()}catch(b){}},_handleMozzEngine:function(){"undefined"===typeof window.mozPaintCount&&"function"!==typeof navigator.webkitGetUserMedia||this.window.open("about:blank").close()}};try{for(var c in b)a[c]=b[c]}catch(d){}},_generateWindowName:function(){var a="rnd_"+Math.random().toString(36).substr(2,8);return this._getUniqueWinName(a)},
_getUniqueWinName:function(a){if(!a)return!1;a=this._normalizeWindowName(a);a+="_"+this.guid+"_";for(var b=0;this.allWindowNames[a+b];b++);this.allWindowNames[a+b]=1;return a+b},_isWindowOpen:function(a){return a&&this.windowCache[a]&&!this.windowCache[a].closed&&this.windowCache[a]},_openChromePlaceholder:function(a,b,c){if(!a||!b)return!1;this._openWithClickTrigger("about:blank","tab",a);return window.open(b,a)},_openDefaultPlaceholder:function(a,b,c){if(!a||!b)return!1;c=this.opts.position;a=this._openDefaultPopup(b,
a,c.top,c.left,c.width,c.height);if(!a)return!1;this._blurWindow(a);return a},_openWithClickTrigger:function(a,b,c){if(!a||!b)return!1;var d=document.createElement("a");d.href=a;c&&(d.target=c);document.body.appendChild(d);a=this._getClickEvent("tab"==b||"focusedtab"==b?!0:!1,"window"==b||"focusedtab"==b?!0:!1,!1);d.dispatchEvent(a);d.parentNode.removeChild(d);return!0},_getClickEvent:function(a,b,c){var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!1,!0,window,0,0,0,0,0,a?!0:!1,
c?!0:!1,b?!0:!1,!0,0,null);return d}};
/*deleteCache-description:AutoSuggestion used inside the WP Plugin; jQUery compatible.*/
/*deleteCache-minimizeJS:true*/
window.undefined=window.undefined;function loading(){};var parentObject=this;function cloneObject(src){var dest=new Object;for(i in src){if(typeof src[i]=='object'){dest[i]=cloneObject(src[i])}else dest[i]=src[i]}return dest};parentObject.getPos=function(e){var o=jQuery(e).offset();return{'x':o.left,'y':o.top}};var defaultParams={script:"ajax/suggestions/airports.php",minchars:3,className:"as",delay:500,timeout:2500,cache:true,loadingClass:"aLoad",offsety:2,showNoResults:false,maxheight:250,noResults:"No results!",meth:"POST",json:false,frameForIE:true,autoSelect:true,ajaxParams:{action:"test",json:this.json},setAjaxParams:function(asObj){var idx=0,aPrms='';for(key in this.ajaxParams){if(idx==0)aPrms+=key+'='+asObj.fld.value;else aPrms+='&'+key+'='+this.ajaxParams[key];idx++}asObj.ajaxObject.data=aPrms;return true},setAjaxParams:function(asObj){var idx=0,aPrms='';for(key in this.ajaxParams){if(idx==0)aPrms+=key+'='+asObj.fld.value;else aPrms+='&'+key+'='+this.ajaxParams[key];idx++}asObj.ajaxObject.data=aPrms;return true},format:function(liObj){return liObj.innerHTML.replace(/<\/?[a-z]+>/gi,'')},errorHandler:function(asObj){return}};if(parentObject.AutoSuggest==undefined){parentObject.AutoSuggest={}};parentObject.AutoSuggest=function(fldID,pObj){if(!(this.fld=jQuery('#'+fldID)[0]))return false;this.fld.setAttribute("autocomplete","off");this.sInput="";this.nInputChars=0;this.aSuggestions={};this.defText=this.fld.value;this.highlighted=null;this.opt=pObj?cloneObject(pObj):{};for(k in defaultParams){if(typeof(this.opt[k])!=typeof(defaultParams[k])){this.opt[k]=defaultParams[k]}};var pointer=this;this.ajaxObject={url:this.opt.script,global:false,type:this.opt.meth,dataType:'text',data:this.opt.ajaxParams,error:function(req,errmsg,exc){},success:function(rsp){pointer.generateList(rsp)},errorFlag:0,complete:function(reqObj,tos){}};this.coords=getPos(this.fld);this.coords.y+=this.fld.offsetHeight+this.opt.offsety;if(this.opt.frameForIE&&jQuery.browser.msie&&parseInt(jQuery.browser.version)<7){this.iframe=jQuery('<iframe src="about:blank" frameborder="0" marginheight="0" marginwidth="0" scrolling="no" style="position:absolute;background:#fff;z-index:399;">')}else{this.opt.frameForIE=false};this.blurTimer=0;var pointer=this;this.isFocused=true;this.fld.onkeypress=function(ev){return pointer.onKeyPress(ev)};this.fld.onkeyup=function(ev){return pointer.onKeyUp(ev)};this.fld.onblur=function(ev){pointer.isFocused=false;if(!pointer.fld.value)return;pointer.blurTimer=setTimeout(function(){if(pointer.ajaxObject.errorFlag)pointer.opt.errorHandler(this);if(pointer.opt.autoSelect)pointer.setHighlightedValue();else pointer.clearSuggestions(ev);pointer.highlighted=null},pointer.opt.delay/2)};this.fld.onfocus=function(ev){pointer.highlighted=null;pointer.isFocused=true};this.req={};this.fld.autoSuggest=this};parentObject.AutoSuggest.prototype.onKeyUp=function(ev){var key=(window.event)?window.event.keyCode:ev.keyCode;var bubble=true;switch(key){case 38:this.changeHighlight(key);bubble=false;break;case 40:this.changeHighlight(key);bubble=false;break;case 13:break;default:this.getSuggestions()}return bubble};parentObject.AutoSuggest.prototype.onKeyPress=function(ev){var key=(window.event)?window.event.keyCode:ev.keyCode;var bubble=true;this.isFocused=true;switch(key){case 13:this.setHighlightedValue();bubble=false;break;case 27:this.setHighlightedValue();break;case 9:break}return bubble};parentObject.AutoSuggest.prototype.getSuggestions=function(){var val=this.fld.value.toLowerCase();if(val==this.sInput)return false;if(val.length<this.opt.minchars){this.clearSuggestions();this.sInput="";return false}this.makeReq=true;if(val.length>this.nInputChars&&this.aSuggestions.length&&this.opt.cache&&this.aSuggestions[0]&&this.aSuggestions[0].childNodes){val=val.replace(/[^a-zA-Z????]/g,' ');with(this.aSuggestions[0]){for(var i=0;i<childNodes.length;i++){if(childNodes[i].nodeType!=1){continue};var txt=childNodes[i].innerHTML.replace(/<\/?[^>]+>/gi,'');if(!txt.toLowerCase().match(val)){removeChild(childNodes[i--])}else{childNodes[i].innerHTML=this.highlightText(childNodes[i].innerHTML,val)}}};if(!this.aSuggestions[0].childNodes.length){this.clearSuggestions();this.doAjaxRequest(this.ajaxObject);return false};this.makeReq=false;if(this.opt.frameForIE)this.updateIframe(this.coords);this.sInput=val;this.nInputChars=val.length;if(!this.aSuggestions[0].parentNode){document.body.appendChild(this.aSuggestions[0]);if(this.opt.frameForIE){document.body.appendChild(this.iframe[0])}};if(this.highlighted){this.clearHighlight()};return false}else{this.sInput=val;this.nInputChars=val.length;var pointer=this;clearTimeout(this.ajID);this.ajID=setTimeout(function(){pointer.doAjaxRequest(pointer.ajaxObject)},this.opt.delay);return false}};parentObject.AutoSuggest.prototype.doAjaxRequest=function(){if(this.fld.value.length<this.opt.minchars){return};jQuery(this.fld).addClass(this.opt.loadingClass);this.opt.setAjaxParams(this);this.req=jQuery.ajax(this.ajaxObject);this.ajaxObject.errorFlag=0};parentObject.AutoSuggest.prototype.generateList=function(req){this.coords=getPos(this.fld);this.coords.y+=this.fld.offsetHeight+this.opt.offsety;this.makeReq=false;if(this.aSuggestions[0]&&this.aSuggestions[0].parentNode){this.aSuggestions.remove()};var jsondata,rsp;if(this.opt.json){try{jsondata=eval('('+req+')')}catch(e){return e}rsp='<ul>';n=jsondata.argumentList?jsondata.argumentList.length:0;for(i=0;i<jsondata.results.length;i++){rsp+='<li';for(j=0;j<n;j++){var argName=jsondata.argumentList[j];var argValue=jsondata.results[i][argName];rsp+=' '+argName+'="'+argValue+'"'}rsp+='>'+jsondata.results[i].txt+'</li>'}rsp+='</ul>'}else{rsp=req.substr(40)};jQuery(this.fld).removeClass(this.opt.loadingClass);if(this.isFocused){this.createList(rsp,jsondata)}else{if(this.opt.autoSelect){this.autoSelect(rsp,jsondata)}}};parentObject.AutoSuggest.prototype.autoSelect=function(rsp,jsonObj){if(!jsonObj.results||!jsonObj.results.length){this.opt.errorHandler(this);this.ajaxObject.errorFlag=1;clearTimeout(this.blurTimer);return false}firstElement='<li';n=jsonObj.argumentList?jsonObj.argumentList.length:0;for(j=0;j<n;j++){var argName=jsonObj.argumentList[j];var argValue=jsonObj.results[0][argName];firstElement+=' '+argName+'="'+argValue+'"'}firstElement+='>'+jsonObj.results[0].txt+'</li>';this.highlighted=jQuery(firstElement).get(0);this.setHighlightedValue();return true};parentObject.AutoSuggest.prototype.createList=function(rsp,jsonObj){if(!jsonObj.results||!jsonObj.results.length){this.ajaxObject.errorFlag=1;return false}var pointer=this;pointer.aSuggestions=jQuery(rsp).attr({"class":pointer.opt.className,"id":"as"+pointer.fld.id}).css({left:pointer.coords.x,top:pointer.coords.y}).appendTo('body').css({display:'block'});pointer.aSuggestions.hide();pointer.aSuggestions.show();internal_cnt=0;pointer.aSuggestions.find('li').each(function(){internal_cnt++;jQuery(this).addClass(internal_cnt%2==0?'even':'odd')});if(this.opt.frameForIE)this.updateIframe(this.coords).appendTo('body');pointer.aSuggestions.children("li").each(function(idx){this.innerHTML=pointer.highlightText(this.innerHTML,pointer.fld.value);jQuery(this).mousedown(function(){pointer.setHighlightedValue();pointer.fld.focus()});jQuery(this).mouseover(function(){pointer.setHighlight(this)})});if(!this.isFocused){this.setHighlightedValue();return}pointer.highlighted=null;if(pointer.aSuggestions[0].childNodes.length==0){if(pointer.opt.showNoResults){pointer.aSuggestions.append('<li>'+pointer.opt.noResults+'</li>')}else{pointer.clearSuggestions()}};return};parentObject.AutoSuggest.prototype.changeHighlight=function(key){if(!this.aSuggestions[0]){return false};if(this.highlighted==null){return this.setHighlight(this.highlighted=this.aSuggestions[0].firstChild)};if(key==38){if(this.highlighted==this.aSuggestions[0].firstChild){return this.setHighlight(this.aSuggestions[0].lastChild)};return(this.highlighted.previousSibling.nodeType==1)?this.setHighlight(this.highlighted.previousSibling):this.setHighlight(this.highlighted.previousSibling.previousSibling)}else{if(this.highlighted==this.aSuggestions[0].lastChild){return this.setHighlight(this.aSuggestions[0].firstChild)};return((this.highlighted.nextSibling.nodeType==1)?this.setHighlight(this.highlighted.nextSibling):this.setHighlight(this.highlighted.nextSibling.nextSibling))}};parentObject.AutoSuggest.prototype.setHighlight=function(liObj){if(this.highlighted!=null){this.clearHighlight()};this.highlighted=liObj;jQuery(this.highlighted).addClass('as_hl');return true};parentObject.AutoSuggest.prototype.clearHighlight=function(){jQuery(this.highlighted).removeClass('as_hl');this.highlighted=null};parentObject.AutoSuggest.prototype.setHighlightedValue=function(){if(this.ajaxObject.errorFlag){return};clearTimeout(this.blurTimer);if(!this.fld.value){return};if(!this.highlighted){try{var t=this.aSuggestions&&this.aSuggestions.children&&this.aSuggestions.children('li:eq(0)').get(0)}catch(err){};if(!t){this.clearSuggestions();return false}this.setHighlight(t)}if(this.highlighted&&!this.makeReq){this.sInput=this.fld.value=this.opt.format(this.highlighted)};if(typeof(this.opt.callback)=="function"){this.opt.callback(this.highlighted,this)};this.clearSuggestions();return true};parentObject.AutoSuggest.prototype.clearSuggestions=function(){if(this.aSuggestions[0]){jQuery(this.aSuggestions[0]).remove()};this.aSuggestions[0]=null;if(this.opt.frameForIE){jQuery(this.iframe[0]).remove()};this.highlighted=null};parentObject.AutoSuggest.prototype.updateIframe=function(objCoords){return this.iframe.css({left:objCoords.x,top:objCoords.y,width:(this.aSuggestions[0].clientWidth),height:(this.aSuggestions[0].clientHeight)})};parentObject.AutoSuggest.prototype.highlightText=function(sourceTxt,highlightTxt){sourceTxt=sourceTxt.replace(/<b>(.+)<\/b>/i,'$1');var strippedTxt=sourceTxt.replace(/<i>.+<\/i>/i,'');strippedTxt=strippedTxt.replace(/<\/?[^>]+>/gi,'');var rExp=new RegExp("("+highlightTxt+")",'i');highlighedTxt=strippedTxt.replace(rExp,"<b>$1</b>");return sourceTxt.replace(strippedTxt,highlighedTxt)};parentObject.AS=parentObject.AutoSuggest;
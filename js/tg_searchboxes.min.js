/*deleteCache-description:js file used on Frontend on WP Plugin*/
/*deleteCache-minimizeJS:true*/
var popupWPos=0;var ajaxLoaders={'160x600':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','300x250':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','300x533':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','728x90':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />','dynamic':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />'};var tgsb_searchboxesParams={};function TGSearchboxes(){this.queryCodes={flights:0,hotels:0,cars:0,packages:0};this.set=function(queryCodeMember,queryCodeMemberValue){this.queryCodes[queryCodeMember]=queryCodeMemberValue;return true}};TGSB=new TGSearchboxes();var ASoptions={delay:175,timeout:5000,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:'tgsb_as_load',className:'tgsb_as tgsb_asMargin',json:true,frameForIE:true,ajaxParams:{action:'',json:true,lng:'def',dsgn:'flg',addtag:'em',citytype:'airports',domainPrefix:true},autoSelect:true,offsety:0,format:function(selLiObj){return selLiObj.innerHTML.replace(/<\/?[a-z]+>/gi,'').replace(/(.*),(.*)\((.*)\)/,'$1 ($3)')},callback:function(selLiObj,asObj){var searchboxsize=jQuery(asObj.fld).parents('.tg_searchbox').attr('class').match(/(300x250|728x90)$/);if(searchboxsize==null)makeMerchantsRequest(asObj.fld)},errorHandler:function(asObj){jQuery(asObj.fld).addClass("err").focus(remErr)}};var hotelASoptions={delay:175,timeout:5000,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:'tgsb_as_load',className:'tgsb_as tgsb_asMargin',json:true,frameForIE:true,ajaxParams:{action:'',json:true,lng:'def',dsgn:'flg',addtag:'em',citytype:'cities',domainPrefix:true},autoSelect:true,offsety:0,format:function(selLiObj){return selLiObj.innerHTML.replace(/<\/?[^>]+>/gi,'').replace(/(.*),(.*) \((.*)\)/,'$1,$2')},callback:function(selLiObj,asObj){var inp=jQuery(asObj.fld);inp.parents('div.tg_searchbox').find(".tgsb_addDest").val(selLiObj.id);var searchboxsize=inp.parents('.tg_searchbox').attr('class').match(/(300x250|728x90)$/);if(searchboxsize==null)makeMerchantsRequest(asObj.fld)}};function remErr(){jQuery(this).removeClass("err").unbind('focus',remErr)};function inputFocus(ev){if(this.value==this.defaultValue)this.value='';else this.select()};function inputBlur(ev){if(this.value=='')this.value=this.defaultValue};function validateSearchbox(obj,onsbmt,addErrorClass){onsbmt=(typeof(onsbmt)=='undefined'||!onsbmt)?false:true;addErrorClass=(typeof(addErrorClass)=='undefined'||!addErrorClass)?false:true;errMsg='';errClass='';var patt1=/^.*\s\(...\)$/i;var patt2=/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/;var currentForm=jQuery(obj).parents('form');if(!currentForm.hasClass('hotels')){departure=currentForm.find('input.asFrom')};var arrival=currentForm.find('input.asTo');var departureDate=currentForm.find('input.depDate');var returnDate=currentForm.find('input.retDate');var date=new Date();var d1=departureDate.datepicker('getDate');var d2=returnDate.datepicker('getDate');if(currentForm.hasClass('flights')){rtowInputs=currentForm.find('input[name=oneway]');var owChk=false;if(typeof(rtowInputs.get(0))!='undefined'&&typeof(rtowInputs.get(1))!='undefined'){rt=rtowInputs.get(0).id;ow=rtowInputs.get(1).id;owChk=jQuery('#'+ow).attr('checked')}};if(!currentForm.hasClass('hotels')){if(!patt1.test(departure.val())){errMsg+="\t- a departure location\n";errClass+='#'+departure.get(0).id+','}};if(currentForm.hasClass('hotels')){if(arrival.val().length<3){errMsg+="\t- an arrival location\n";errClass+='#'+arrival.get(0).id+','}}else{if(!patt1.test(arrival.val())){errMsg+="\t- an arrival location\n";errClass+='#'+arrival.get(0).id+','}};if(!patt2.test(departureDate.val())||(d1>0&&d1<date)){errMsg+="\t- a valid departure date\n";errClass+='#'+departureDate.get(0).id+','};if(currentForm.hasClass('flights')){if(!owChk&&!patt2.test(returnDate.val())){errMsg+="\t- a valid returning date\n";errClass+='#'+returnDate.get(0).id+','};if(!owChk&&d1>0&&d2>0&&d1>d2){errMsg+="\t- a greater returning date than the departure date\n";errClass+='#'+returnDate.get(0).id+','}}else{if(!patt2.test(returnDate.val())){errMsg+="\t- a valid returning date\n";errClass+='#'+returnDate.get(0).id+','};if(d1>0&&d2>0&&d1>d2){errMsg+="\t- a greater returning date than the departure date\n";errClass+='#'+returnDate.get(0).id+','}};if(errClass.match(/\,$/)){errClass=errClass.substr(0,(errClass.length-1))};if(addErrorClass){jQuery(errClass).addClass("err").focus(remErr)};if(onsbmt){var selectedMerchants=currentForm.find('div.mrcList span.mSel');if(selectedMerchants.length<1){if(errMsg.length==0){alert('Please select at least one merchant.');return false}else{errMsg+="Please select at least one merchant.\n"}}};return errMsg.length?"Please enter:\n"+errMsg:false};function makeClassicSearchRequest(obj){var errMsg=validateSearchbox(obj,true,true);if(errMsg.length){alert(errMsg);return false};ppups(obj);jQuery(obj).removeClass('submited');return true};function ppups(obj){var fields=(typeof(obj)!='undefined')?jQuery(obj).parents('form').serializeArray():'';var queryString=createQueryString(obj,fields);if(!queryString)return false;var searchbox=jQuery(obj).parents('form');var tgsb_querycode=1;var url='';if(searchbox.hasClass('flights')){url='http://www.travelgrove.com/cgi-bin/link_counter_new.cgi?channel=3';tgsb_querycode=TGSB.queryCodes['flights']};if(searchbox.hasClass('hotels')){url='http://www.travelgrove.com/cgi-bin/hotels/link_counter_new.cgi?channel=6';tgsb_querycode=TGSB.queryCodes['hotels']};if(searchbox.hasClass('packages')){url='http://www.travelgrove.com/cgi-bin/vacation/link_counter_new.cgi?channel=7';tgsb_querycode=TGSB.queryCodes['packages']};if(searchbox.hasClass('cars')){url='http://www.travelgrove.com/cgi-bin/cars/link_counter_new.cgi?channel=4';tgsb_querycode=TGSB.queryCodes['cars']};if(url.length==0)return false;var separator=url.indexOf('?')>=0?'&':'?';url+=separator+queryString+'&lang=def'+'&dateFormat=mm/dd/yyyy'+'&trafficSource=wpplugin'+'&searchsystem=us'+'&querycode='+tgsb_querycode;searchbox.find(".mrcList .mSel").each(function(){var t=jQuery(this);jump(url+'&merchant='+t.attr('title')+'&intitem='+t.attr('rel'))});return true};function jump(url){var myWinCoord="left="+(popupWPos+=20)+",top="+popupWPos+",width="+(screen.width*0.8)+",height="+(screen.height*0.8)+",resizable = yes,scrollbars=yes, toolbar=yes, location=yes";var nw=window.open(url,"_blank",myWinCoord);if(!nw)return false;return nw};function makeMerchantsRequest(obj,showErrorMessages,addErrorClass){showErrorMessages=(typeof(showErrorMessages)=='undefined'||!showErrorMessages)?false:true;addErrorClass=(typeof(addErrorClass)=='undefined'||!addErrorClass)?false:true;var tgsb_querycode=0;var searchboxsize=jQuery(obj).parents('.tg_searchbox').attr('class').match(/(160x600|300x250|300x533|728x90|dynamic)$/);var searchboxId=jQuery(obj).parents('.tg_searchbox').get(0).id;if(searchboxsize==null||(searchboxsize[1]!='160x600'&&searchboxsize[1]!='300x250'&&searchboxsize[1]!='300x533'&&searchboxsize[1]!='728x90'&&searchboxsize[1]!='dynamic'))return false;var searchbox=jQuery(obj).parents('form');var submitButton=searchbox.find('input.tgsb_submit_button');if((errMsg=validateSearchbox(obj,false,addErrorClass))){if(showErrorMessages)alert(errMsg);jQuery(submitButton).removeClass('submited');return false};var fields=(typeof(obj)!='undefined')?jQuery(obj).parents('form').serializeArray():'';var queryString=createQueryString(obj,fields);if(!queryString)return false;var searchboxType=searchbox.attr('class').match(/(flights|hotels|packages|cars)/);if(searchboxType==null)return false;var merchantsContainer=searchbox.find('div.mrcList');if(typeof(tgsb_searchboxesParams[searchboxId])=='undefined'){tgsb_searchboxesParams[searchboxId]={}};if(typeof(tgsb_searchboxesParams[searchboxId][searchboxType])=='undefined'||tgsb_searchboxesParams[searchboxId][searchboxType]!=queryString){if(searchboxsize[1]!='dynamic')searchbox.find('div.formContent').addClass('nod');merchantsContainer.html(ajaxLoaders[searchboxsize[1]]);merchantsContainer.addClass('alCnt').removeClass('nod');var merchantsLimit=7;if(searchboxsize[1]=='728x90')merchantsLimit=6;if(searchboxsize[1]=='300x250')merchantsLimit=8;if(searchboxsize[1]=='300x533'||searchboxsize[1]=='dynamic')merchantsLimit=12;if(searchboxType[1]=='hotels'&&searchboxsize[1]=='160x600')merchantsLimit=10;tgsb_searchboxesParams[searchboxId][searchboxType]=queryString;if(searchbox.hasClass('flights')){tgsb_querycode=TGSB.queryCodes['flights']};if(searchbox.hasClass('hotels')){tgsb_querycode=TGSB.queryCodes['hotels']};if(searchbox.hasClass('packages')){tgsb_querycode=TGSB.queryCodes['packages']};if(searchbox.hasClass('cars')){tgsb_querycode=TGSB.queryCodes['cars']};jQuery.ajax({url:TG_Searchboxes_Variables.str_merchantsAjaxURL,type:'post',data:queryString+'&impId='+tgsb_querycode+'&merchants='+searchboxType[1]+'&sbsize='+searchboxsize[1]+'&limit='+merchantsLimit,dataType:'text',success:function(rsp){jsonObj=eval('('+rsp+')');searchbox.find('div.help').addClass('nod');merchantsContainer.removeClass('alCnt');merchantsContainer.html(jsonObj.merchants+((searchboxsize[1]=='300x250'||searchboxsize[1]=='728x90')?'<a href="#" class="tgBackToSearchbox">change this search</a>':''));var trackingPixel=searchbox.find('img.trackingPixel');if(!trackingPixel.length){merchantsContainer.after('<img class="trackingPixel" src="'+jsonObj.trackingPixel+'" width="1" height="1" />')};if(trackingPixel.length){trackingPixel.get(0).src=jsonObj.trackingPixel};var merchants=searchbox.find('div.mrcList').find('span');submitButton.addClass('tgsb_submit_button_cmp');submitButton.val('compare prices');submitButton.unbind('click').click(function(){makeClassicSearchRequest(this);return false});if(searchboxsize[1]=='300x250'||searchboxsize[1]=='728x90'||searchboxsize[1]=='dynamic'){searchbox.find('div.mrcList a.tgBackToSearchbox').click(function(){merchantsContainer.addClass('nod');searchbox.find('div.formContent').removeClass('nod');submitButton.removeClass('tgsb_submit_button_cmp');submitButton.val('find sites');submitButton.unbind('click').click(function(){makeMerchantsRequest(this);return false});return false})};merchants.each(function(){jQuery(this).click(function(){jQuery(this).toggleClass('mSel')})});jQuery(submitButton).removeClass('submited')}});return true};if(typeof(tgsb_searchboxesParams[searchboxId][searchboxType])!='undefined'||tgsb_searchboxesParams[searchboxId][searchboxType]==queryString){if(searchboxsize[1]!='dynamic')searchbox.find('div.formContent').addClass('nod');submitButton.addClass('tgsb_submit_button_cmp');submitButton.val('compare prices');merchantsContainer.removeClass('nod');submitButton.unbind('click').click(function(){makeClassicSearchRequest(this);return false})}};function createQueryString(obj,fields){if(typeof(fields)=='undefined'||fields.length==0)return false;var queryString='';jQuery.each(fields,function(i,field){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'&&(field.name=='dep_date'||field.name=='arr_date'||field.name=='start_date'||field.name=='end_date')){var contForm=jQuery(obj).parents('form');tgsb_date=contForm.find('input[name='+field.name+']:eq(0)').datepicker('getDate');queryString+=field.name+'='+setDateByDateFormat(tgsb_date)+((i<(queryString.length-1))?'&':'')};queryString+=(queryString.match(field.name+'=')&&(field.name=='dep_date'||field.name=='arr_date'||field.name=='start_date'||field.name=='end_date'))?'':field.name+'='+field.value+((i<(fields.length-1))?'&':'')});return queryString};function makeImpressionTrackingRequest(selectedTab,frmObj,callback){if(typeof(selectedTab)=='undefined')return false;if(typeof(callback)!='function')callback=function(){};if(TGSB.queryCodes[selectedTab]==0){var impressionTrackingQueryString=createImpressionTrackingQueryString(frmObj);if(impressionTrackingQueryString.length==0)return false;impressionTrackingQueryString+='&searchbox='+selectedTab;jQuery.getScript('http://www.travelgrove.com/js/affiliates/wpPluginImpTrack.php?'+impressionTrackingQueryString,callback)};return true};function createImpressionTrackingQueryString(frmObj){if(typeof(frmObj)=='undefined')return'';var tgsbFrom=(typeof(frmObj.find('.asFrom').val())!='undefined')?'from='+frmObj.find('.asFrom').val()+'&':'';var tgsbTo=(typeof(frmObj.find('.asTo').val())!='undefined')?'to='+frmObj.find('.asTo').val()+'&':'';var tgsbDepDate='';var tgsbRetDate='';if((typeof(frmObj.find('.depDate').val())!='undefined')){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'){tgsbDepDate=frmObj.find('.depDate').val();newtgsbDepDate=tgsbDepDate.split('/');tgsbDepDate=newtgsbDepDate[1]+'/'+newtgsbDepDate[0]+'/'+newtgsbDepDate[2]};tgsbDepDate='dep_date='+tgsbDepDate+'&'};if((typeof(frmObj.find('.retDate').val())!='undefined')){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'){tgsbRetDate=frmObj.find('.retDate').val();newtgsbRetDate=tgsbRetDate.split('/');tgsbRetDate=newtgsbRetDate[1]+'/'+newtgsbRetDate[0]+'/'+newtgsbRetDate[2]};tgsbRetDate='ret_date='+tgsbRetDate+'&'};var tgsbIdReferral=(typeof(frmObj.find('input[name=idReferral]').val())!='undefined')?'idReferral='+frmObj.find('input[name=idReferral]').val():999;var tgsbSubID=(typeof(frmObj.find('input[name=subID]').val())!='undefined')?'subID='+frmObj.find('input[name=subID]').val():106;return tgsbFrom+tgsbTo+tgsbDepDate+tgsbRetDate+tgsbIdReferral+'&'+tgsbSubID};function setDateByDateFormat(dateObj){tgsb_day=(dateObj.getDate()<10)?'0'+dateObj.getDate():dateObj.getDate();tgsb_month=dateObj.getMonth();tgsb_month+=1;tgsb_month=(tgsb_month<10)?'0'+tgsb_month:tgsb_month;tgsb_year=dateObj.getFullYear();return tgsb_month+'/'+tgsb_day+'/'+tgsb_year};function createDatepicker(i1,i2,rtowInputs){jQuery('#'+i1+', #'+i2).each(function(){var inp=jQuery(this);inp.datepicker({minDate:0,maxDate:"2y",showOn:"both",buttonImage:TG_Searchboxes_Variables.str_CalendarURL,buttonImageOnly:true,dateFormat:TG_Searchboxes_Variables.str_dateFormat,onSelect:function(date,dpObj){d1=jQuery(this).datepicker("getDate");if(this.id==i1){d2=jQuery.datepicker.parseDate(TG_Searchboxes_Variables.str_dateFormat,jQuery('#'+i2).val());jQuery("#"+i2).datepicker('option','minDate',d1);if(d2&&d1>d2){d2.setTime(d1.getTime()+60*60*24*5*1000);jQuery("#"+i2).val(jQuery.datepicker.formatDate(TG_Searchboxes_Variables.str_dateFormat,d2))}}}})});if(typeof(rtowInputs)=='object'&&rtowInputs.length>0){if(rtowInputs.length==1){var selectRTOW=rtowInputs.get(0).id;jQuery('#'+selectRTOW).change(function(){jQuery('#'+i2).attr('disabled',((this.value.length)?true:false))})};if(rtowInputs.length==2){var rt=rtowInputs.get(0).id;var ow=rtowInputs.get(1).id;var searchboxsize=jQuery('#'+i2).parents('.tg_searchbox').attr('class').match(/(160x600|300x250|300x533|728x90|dynamic)$/);jQuery('#'+ow).change(function(){if(this.checked){jQuery('#'+i2).attr('disabled',true);if(searchboxsize!=null&&(searchboxsize[1]=='160x600'||searchboxsize[1]=='300x533'||searchboxsize[1]=='dynamic'))makeMerchantsRequest(jQuery('#'+i2).get(0))}});jQuery('#'+rt).change(function(){if(this.checked){jQuery('#'+i2).attr('disabled',false);if(searchboxsize!=null&&(searchboxsize[1]=='160x600'||searchboxsize[1]=='300x533'||searchboxsize[1]=='dynamic'))makeMerchantsRequest(jQuery('#'+i2).get(0))}})}}};function tgsb_setSearchboxDetails(selectedTab,roundTripOneWay,fromDepart,toArrival,departDate,returnDate){if(typeof(selectedTab)=='undefined'||typeof(roundTripOneWay)=='undefined'||typeof(fromDepart)=='undefined'||typeof(toArrival)=='undefined'||typeof(departDate)=='undefined'||typeof(returnDate)=='undefined')return false;var cont=jQuery('#content').find('div.tg_searchbox');if(!cont.find('ul.tg_tabs li span.sel').hasClass(selectedTab))return false;var searchform=cont.find('form.sel');var submitButton=searchform.find('input.tgsb_submit_button');var departLocationInput=searchform.find('input.asFrom');var arrivalLocationInput=searchform.find('input.asTo');var departDateInput=searchform.find('input.depDate');var returnDateInput=searchform.find('input.depDate');if(typeof(departLocationInput)=='object'&&departLocationInput.length>0){departLocationInput.val(fromDepart)};if(typeof(arrivalLocationInput)=='object'&&arrivalLocationInput.length>0){arrivalLocationInput.val(toArrival)};if(typeof(departDateInput)=='object'&&departDateInput.length>0){departDateInput.val(departDate)};if(typeof(returnDateInput)=='object'&&returnDateInput.length>0){returnDateInput.val(returnDate)};if(selectedTab=='flights'){var rtowInputs=false;var rtowInputs=currentForm.hasClass('flights')?jQuery(this).find('input[name=oneway]'):false;if(typeof(rtowInputs)=='object'&&rtowInputs.length>0){var rt=rtowInputs.get(0).id;var ow=rtowInputs.get(1).id;if(!roundTripOneWay){jQuery('#'+ow).click()}}};makeMerchantsRequest(submitButton.get(0));return false};jQuery(function(){var formsContainer=jQuery('.tg_searchbox');jQuery(".tgsb_addAS").each(function(){jQuery(this).focus(inputFocus).blur(inputBlur);new AS(this.id,ASoptions)});jQuery(".tgsb_addASH").each(function(){jQuery(this).focus(inputFocus).blur(inputBlur);new AS(this.id,hotelASoptions)});jQuery('div.tg_searchbox ul.tg_tabs li span').click(function(){selectedTab=jQuery(this).attr('class').match(/^[a-z]+/);var cont=jQuery(this).parents("div.tg_searchbox:eq(0)");cont.find('ul.tg_tabs li span').removeClass('sel');cont.find('ul.tg_tabs li span.'+selectedTab).addClass('sel');cont.find('div.tg_container form').removeClass('sel');cont.find('div.tg_container form.'+selectedTab).addClass('sel');var selectedForm=cont.find('div.tg_container form.sel');var submitButton=selectedForm.find('input.tgsb_submit_button');makeImpressionTrackingRequest(selectedTab,selectedForm,function(){var searchboxsize=selectedForm.parents('.tg_searchbox').attr('class').match(/(160x600|300x250|300x533|728x90|dynamic)$/);if(searchboxsize[1]=='160x600'||searchboxsize[1]=='300x533'||searchboxsize[1]=='dynamic')makeMerchantsRequest(submitButton.get(0),false,false)})});formsContainer.find('form').each(function(){var currentForm=jQuery(this);var searchboxsize=currentForm.parents('.tg_searchbox').attr('class').match(/(160x600|300x250|300x533|728x90|dynamic)$/);var submitButton=currentForm.find('input.tgsb_submit_button');if(currentForm.hasClass('sel')){selectedTab=currentForm.attr('class').match(/^[a-z]+/);makeImpressionTrackingRequest(selectedTab,currentForm,function(){var searchboxsize=currentForm.parents('.tg_searchbox').attr('class').match(/(160x600|300x250|300x533|728x90|dynamic)$/);if(searchboxsize[1]=='160x600'||searchboxsize[1]=='300x533'||searchboxsize[1]=='dynamic')makeMerchantsRequest(submitButton.get(0),false,false)})};var airClass=currentForm.find('select[name=class]');if(airClass.length){airClass.change(function(){makeMerchantsRequest(this)})};var inputs=currentForm.find(".tgsb_addDP");var i1=inputs.get(0).id;var i2=inputs.get(1).id;var rtowInputs=false;var rtowInputs=currentForm.hasClass('flights')?jQuery(this).find('input[name=oneway], select[name=oneway]'):false;createDatepicker(i1,i2,rtowInputs);jQuery(this).submit(function(){if(submitButton.hasClass('submited'))return false;submitButton.addClass('submited');makeMerchantsRequest(submitButton.get(0),true,true);return false})})});
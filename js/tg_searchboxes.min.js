(function(f){function H(){TGSB.pph=new PPH({def:{afterTrigger:function(a){this.windows={};f(".mrcList .mSel").trigger("uncheck")}},ie:{type:"popunderwindow",when:"trigger",onTrigger:function(){}}})}function t(){f(this).removeClass("err").unbind("focus",t)}function w(a){this.value==this.defaultValue?this.value="":this.select()}function x(a){""==this.value&&(this.value=this.defaultValue)}function y(a,c){f(function(){var d=f(c),e=f("span#"+a);if(0==e.length)return!1;e.replaceWith(d);z(d)})}function A(a,
c,d){c="undefined"!=typeof c&&c?!0:!1;d="undefined"!=typeof d&&d?!0:!1;var e="",b="",h=/^.*\s\(...\)$/i,g=/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/;a=f(a).parents("form");var k;a.hasClass("hotels")||(k=a.find("input.asFrom"));var m=a.find("input.asTo"),u=a.find("input.depDate"),p=a.find("input.retDate"),I=new Date,q=u.datepicker("getDate"),l=p.datepicker("getDate");if(!a.hasClass("cruises")){if(a.hasClass("flights")){var n=a.find("input[name=oneway]"),r=!1;"undefined"!=typeof n.get(0)&&"undefined"!=typeof n.get(1)&&
(n.get(0),r=n.get(1).id,r=f("#"+r).attr("checked"))}a.hasClass("hotels")||h.test(k.val())||(e+="\t- a departure location\n",b+="#"+k.get(0).id+",");a.hasClass("hotels")?3>m.val().length&&(e+="\t- an arrival location\n",b+="#"+m.get(0).id+","):h.test(m.val())||(e+="\t- an arrival location\n",b+="#"+m.get(0).id+",");if(!g.test(u.val())||0<q&&q<I)e+="\t- a valid departure date\n",b+="#"+u.get(0).id+",";a.hasClass("flights")?(r||g.test(p.val())||(e+="\t- a valid returning date\n",b+="#"+p.get(0).id+","),
!r&&0<q&&0<l&&q>l&&(e+="\t- a greater returning date than the departure date\n",b+="#"+p.get(0).id+",")):(g.test(p.val())||(e+="\t- a valid returning date\n",b+="#"+p.get(0).id+","),0<q&&0<l&&q>l&&(e+="\t- a greater returning date than the departure date\n",b+="#"+p.get(0).id+","))}b.match(/\,$/)&&(b=b.substr(0,b.length-1));d&&f(b).addClass("err").focus(t);if(c&&1>a.find("div.mrcList span.mSel").length){if(0==e.length)return alert("Please select at least two providers to compare their prices."),!1;
e+="Please select at least two providers to compare their prices.\n"}return e.length?"Please enter:\n"+e:!1}function B(a){var c=A(a,!0,!0);if(c.length)return alert(c),!1;J(a);f(a).removeClass("submited");return!0}function v(a,c,d){if(!a||!c||!d)return!1;var e="undefined"!=typeof a?f(a).parents("form").serializeArray():"",e=C(a,e);if(!e)return!1;var b=f(a).parents("form"),h=1,g="";b.hasClass("flights")&&(g="http://www.travelgrove.com/cgi-bin/link_counter_new.cgi?channel=3",h=TGSB.queryCodes.flights);
b.hasClass("hotels")&&(g="http://www.travelgrove.com/cgi-bin/hotels/link_counter_new.cgi?channel=6",h=TGSB.queryCodes.hotels);b.hasClass("packages")&&(g="http://www.travelgrove.com/cgi-bin/vacation/link_counter_new.cgi?channel=7",h=TGSB.queryCodes.packages);b.hasClass("cars")&&(g="http://www.travelgrove.com/cgi-bin/cars/link_counter_new.cgi?channel=4",h=TGSB.queryCodes.cars);b.hasClass("cruises")&&(g="http://www.travelgrove.com/cgi-bin/cruises/link_counter_new.cgi?channel=5",h=TGSB.queryCodes.cruises);
if(0==g.length)return!1;b=0<=g.indexOf("?")?"&":"?";return g+=b+e+"&lang=def&dateFormat=mm/dd/yyyy&trafficSource=wpplugin&searchsystem=us&querycode="+h+"&merchant="+c+"&intitem="+d+"&sbox="+f(a).parents(".tg_searchbox:eq(0)").attr("id")}function J(a){if(!a)return!1;f(a).parents("form:eq(0)").find(".mrcList .mSel").each(function(){var c=f(this),d=c.attr("title"),e=c.attr("rel"),d=v(a,d,e),c=c.data("woid");TGSB.pph.update(c,d)});TGSB.pph.trigger();return!0}function l(a,c,d){c="undefined"!=typeof c&&
c?!0:!1;d="undefined"!=typeof d&&d?!0:!1;var e=0,b=f(a).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/),h=f(a).parents(".tg_searchbox").get(0).id;if(null==b||"160x600"!=b[1]&&"300x250"!=b[1]&&"300x533"!=b[1]&&"728x90"!=b[1]&&"dynamic"!=b[1])return!1;var g=f(a).parents("form"),k=g.find("input.tgsb_submit_button");if(errMsg=A(a,!1,d))return c&&alert(errMsg),f(k).removeClass("submited"),!1;c="undefined"!=typeof a?f(a).parents("form").serializeArray():"";a=C(a,
c);if(!a)return!1;c=g.attr("class").match(/(flights|hotels|packages|cars|cruises)/);if(null==c)return!1;var m=g.find("div.mrcList");"undefined"==typeof n[h]&&(n[h]={});if("undefined"==typeof n[h][c]||n[h][c]!=a){"dynamic"!=b[1]&&g.find("div.formContent").addClass("nod");g.find("div.help").addClass("nod");m.html(D[b[1]]);m.addClass("alCnt").removeClass("nod");d=7;"728x90"==b[1]&&(d=6);"300x250"==b[1]&&(d=8);if("300x533"==b[1]||"dynamic"==b[1])d=12;"hotels"==c[1]&&"160x600"==b[1]&&(d=10);n[h][c]=a;
g.hasClass("flights")&&(e=TGSB.queryCodes.flights);g.hasClass("hotels")&&(e=TGSB.queryCodes.hotels);g.hasClass("packages")&&(e=TGSB.queryCodes.packages);g.hasClass("cars")&&(e=TGSB.queryCodes.cars);g.hasClass("cruises")&&(e=TGSB.queryCodes.cruises);f.ajax({url:TG_Searchboxes_Variables.str_merchantsAjaxURL,type:"post",data:a+"&impId="+e+"&merchants="+c[1]+"&sbsize="+b[1]+"&limit="+d,dataType:"text",success:function(a){a=eval("("+a+")");m.removeClass("alCnt");m.html(a.merchants+("300x250"==b[1]||"728x90"==
b[1]?'<a href="#" class="tgBackToSearchbox">change this search</a>':""));var c=g.find("img.trackingPixel");c.length||m.after('<img class="trackingPixel" src="'+a.trackingPixel+'" width="1" height="1" />');c.length&&(c.get(0).src=a.trackingPixel);a=g.find("div.mrcList").find("span");k.addClass("tgsb_submit_button_cmp");k.val("compare prices");k.unbind("click").click(function(){B(this);return!1});"300x250"!=b[1]&&"728x90"!=b[1]&&"dynamic"!=b[1]||g.find("div.mrcList a.tgBackToSearchbox").click(function(){m.addClass("nod");
g.find("div.formContent").removeClass("nod");k.removeClass("tgsb_submit_button_cmp");k.val("search");k.unbind("click").click(function(){l(this);return!1});return!1});a.bind("check",function(){var a=f(this);if(a.hasClass("mSel"))return!0;a.addClass("mSel");var c=v(a,a.attr("title"),a.attr("rel")),c=TGSB.pph.add(c);a.data("woid",c);c||a.removeClass("mSel")}).bind("uncheck",function(){var a=f(this);if(!a.hasClass("mSel"))return!0;a.removeClass("mSel");var c=a.data("woid");TGSB.pph.remove(c);a.data("woid",
"")}).click(function(){var a=f(this);a.hasClass("mSel")?a.trigger("uncheck"):a.trigger("check")});TGSB.pph.browser.mozilla()&&a.filter('[rel="5760"]').not(".mSel").click();f(k).removeClass("submited")}});return!0}if("undefined"!=typeof n[h][c]||n[h][c]==a)"dynamic"!=b[1]&&g.find("div.formContent").addClass("nod"),k.addClass("tgsb_submit_button_cmp"),k.val("compare prices"),m.removeClass("nod"),k.unbind("click").click(function(){B(this);return!1})}function C(a,c){if("undefined"==typeof c||0==c.length)return!1;
var d="";f.each(c,function(e,b){if("mm/dd/yy"!=TG_Searchboxes_Variables.str_dateFormat&&("dep_date"==b.name||"arr_date"==b.name||"start_date"==b.name||"end_date"==b.name)){var h=f(a).parents("form").find("input[name="+b.name+"]:eq(0)").datepicker("getDate"),g=d,k=b.name+"=";tgsb_day=10>h.getDate()?"0"+h.getDate():h.getDate();tgsb_month=h.getMonth();tgsb_month+=1;tgsb_month=10>tgsb_month?"0"+tgsb_month:tgsb_month;tgsb_year=h.getFullYear();d=g+(k+(tgsb_month+"/"+tgsb_day+"/"+tgsb_year)+(e<d.length-
1?"&":""))}d+=!d.match(b.name+"=")||"dep_date"!=b.name&&"arr_date"!=b.name&&"start_date"!=b.name&&"end_date"!=b.name?b.name+"="+b.value+(e<c.length-1?"&":""):""});return d}function E(a,c,d){if("undefined"==typeof a)return!1;"function"!=typeof d&&(d=function(){});if(0==TGSB.queryCodes[a]||!TGSB.queryCodes[a]){c=K(c);if(0==c.length)return!1;f.getScript("http://www.travelgrove.com/js/affiliates/wpPluginImpTrack.php?"+(c+("&searchbox="+a)),d)}return!0}function K(a){if("undefined"==typeof a)return"";var c=
"undefined"!=typeof a.find(".asFrom").val()?"from="+a.find(".asFrom").val()+"&":"",d="undefined"!=typeof a.find(".asTo").val()?"to="+a.find(".asTo").val()+"&":"",e="",b="";"undefined"!=typeof a.find(".depDate").val()&&("mm/dd/yy"!=TG_Searchboxes_Variables.str_dateFormat&&(e=a.find(".depDate").val(),newtgsbDepDate=e.split("/"),e=newtgsbDepDate[1]+"/"+newtgsbDepDate[0]+"/"+newtgsbDepDate[2]),e="dep_date="+e+"&");"undefined"!=typeof a.find(".retDate").val()&&("mm/dd/yy"!=TG_Searchboxes_Variables.str_dateFormat&&
(b=a.find(".retDate").val(),newtgsbRetDate=b.split("/"),b=newtgsbRetDate[1]+"/"+newtgsbRetDate[0]+"/"+newtgsbRetDate[2]),b="ret_date="+b+"&");var f="undefined"!=typeof a.find("input[name=idReferral]").val()?"idReferral="+a.find("input[name=idReferral]").val():999;a="undefined"!=typeof a.find("input[name=subID]").val()?"subID="+a.find("input[name=subID]").val():106;return c+d+e+b+f+"&"+a+"&trafficSource=wpplugin"}function L(a,c,d){f("#"+a+", #"+c).each(function(){f(this).datepicker({minDate:0,maxDate:"2y",
showOn:"both",buttonImage:TG_Searchboxes_Variables.str_CalendarURL,buttonImageOnly:!0,dateFormat:TG_Searchboxes_Variables.str_dateFormat,onSelect:function(b,d){d1=f(this).datepicker("getDate");this.id==a&&(d2=f.datepicker.parseDate(TG_Searchboxes_Variables.str_dateFormat,f("#"+c).val()),f("#"+c).datepicker("option","minDate",d1),d2&&d1>d2&&(d2.setTime(d1.getTime()+432E6),f("#"+c).val(f.datepicker.formatDate(TG_Searchboxes_Variables.str_dateFormat,d2))))}})});if("object"==typeof d&&0<d.length){if(1==
d.length){var e=d.get(0).id;f("#"+e).change(function(){f("#"+c).attr("disabled",this.value.length?!0:!1)})}if(2==d.length){e=d.get(0).id;d=d.get(1).id;var b=f("#"+c).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);f("#"+d).change(function(){this.checked&&(f("#"+c).attr("disabled",!0),null==b||"160x600"!=b[1]&&"300x533"!=b[1]&&"dynamic"!=b[1]||l(f("#"+c).get(0)))});f("#"+e).change(function(){this.checked&&(f("#"+c).attr("disabled",!1),null==b||"160x600"!=b[1]&&
"300x533"!=b[1]&&"dynamic"!=b[1]||l(f("#"+c).get(0)))})}}}function z(a){a=f(a).filter(":not(.tg_searchbox_initialized)");a.addClass("tg_searchbox_initialized");if(0==a.length)return!1;a.find(".tgsb_addAS").each(function(){f(this).focus(w).blur(x);new AS(this.id,F)});a.find(".tgsb_addASH").each(function(){f(this).focus(w).blur(x);new AS(this.id,G)});a.find("ul.tg_tabs li span").click(function(){selectedTab=f(this).attr("class").match(/^[a-z]+/);var a=f(this).parents("div.tg_searchbox:eq(0)");a.find("ul.tg_tabs li span").removeClass("sel");
a.find("ul.tg_tabs li span."+selectedTab).addClass("sel");a.find("div.tg_container form").removeClass("sel");a.find("div.tg_container form."+selectedTab).addClass("sel");var d=a.find("div.tg_container form.sel"),e=d.find("input.tgsb_submit_button");E(selectedTab,d,function(){var a=d.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);"160x600"!=a[1]&&"300x533"!=a[1]&&"dynamic"!=a[1]||l(e.get(0),!1,!1)})});a.find("form").each(function(){var a=f(this);a.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);
var d=a.find("input.tgsb_submit_button");a.hasClass("sel")&&(selectedTab=a.attr("class").match(/^[a-z]+/),E(selectedTab,a,function(){var b=a.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);"160x600"!=b[1]&&"300x533"!=b[1]&&"dynamic"!=b[1]||l(d.get(0),!1,!1)}));var e=a.find("select[name=class]");e.length&&e.change(function(){l(this)});var b=a.find(".tgsb_addDP");if(1<b.length){var e=b.get(0).id,b=b.get(1).id,h=!1,h=a.hasClass("flights")?a.find("input[name=oneway], select[name=oneway]"):
!1;L(e,b,h)}a.submit(function(){if(d.hasClass("submited"))return!1;d.addClass("submited");l(d.get(0),!0,!0);return!1})})}var D,F,G,n={};TGSB=new function(){this.queryCodes={flights:0,hotels:0,cars:0,packages:0,cruises:0};this.set=function(a,c){this.queryCodes[a]=c;return!0};this.replacePlaceholder=y};TGSB.$=f;TGSB.getJumpLink=v;f(function(){D={"160x600":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"300x250":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+
'" width="100" height="100" alt="loading..." />',"300x533":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"728x90":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />',dynamic:'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />'};F={delay:175,timeout:5E3,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",
json:!0,frameForIE:!0,ajaxParams:{action:"",json:!0,lng:"def",dsgn:"flg",addtag:"em",citytype:"airports",domainPrefix:!0},autoSelect:!0,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[a-z]+[^>]*>/gi,"").replace(/(.*),(.*)\((.*)\)/,"$1 ($3)")},callback:function(a,d){null==f(d.fld).parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/)&&l(d.fld)},errorHandler:function(a){f(a.fld).addClass("err").focus(t)}};G={delay:175,timeout:5E3,script:TG_Searchboxes_Variables.str_ASAjaxURL,
loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",json:!0,frameForIE:!0,ajaxParams:{action:"",json:!0,lng:"def",dsgn:"flg",addtag:"em",citytype:"cities",domainPrefix:!0},autoSelect:!0,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[^>]+>/gi,"").replace(/(.*),(.*) \((.*)\)/,"$1,$2")},callback:function(a,d){var e=f(d.fld);e.parents("div.tg_searchbox").find(".tgsb_addDest").val(a.id);null==e.parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/)&&l(d.fld)}};z(".tg_searchbox");
if("undefined"!=typeof TGSB_placeholders&&0<TGSB_placeholders.length)for(var a=0;a<TGSB_placeholders.length;a++)y(TGSB_placeholders[a].placeholder,TGSB_placeholders[a].html);H()})})(tgsb_myjquery);
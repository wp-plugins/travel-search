(function(jQuery){function TGSearchboxes(){this.queryCodes={flights:0,hotels:0,cars:0,packages:0};this.set=function(e,t){this.queryCodes[e]=t;return true};this.replacePlaceholder=replacePlaceholder}function remErr(){jQuery(this).removeClass("err").unbind("focus",remErr)}function inputFocus(e){if(this.value==this.defaultValue)this.value="";else this.select()}function inputBlur(e){if(this.value=="")this.value=this.defaultValue}function replacePlaceholder(e,t){jQuery(function(){var n=jQuery(t);var r=jQuery("span#"+e);if(r.length==0)return false;r.replaceWith(n);tgsb_initSingleSearchbox(n)})}function validateSearchbox(e,t,n){t=typeof t=="undefined"||!t?false:true;n=typeof n=="undefined"||!n?false:true;errMsg="";errClass="";var r=/^.*\s\(...\)$/i;var i=/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/;var s=jQuery(e).parents("form");if(!s.hasClass("hotels")){departure=s.find("input.asFrom")}var o=s.find("input.asTo");var u=s.find("input.depDate");var a=s.find("input.retDate");var f=new Date;var l=u.datepicker("getDate");var c=a.datepicker("getDate");if(s.hasClass("flights")){rtowInputs=s.find("input[name=oneway]");var h=false;if(typeof rtowInputs.get(0)!="undefined"&&typeof rtowInputs.get(1)!="undefined"){rt=rtowInputs.get(0).id;ow=rtowInputs.get(1).id;h=jQuery("#"+ow).attr("checked")}}if(!s.hasClass("hotels")){if(!r.test(departure.val())){errMsg+="	- a departure location\n";errClass+="#"+departure.get(0).id+","}}if(s.hasClass("hotels")){if(o.val().length<3){errMsg+="	- an arrival location\n";errClass+="#"+o.get(0).id+","}}else{if(!r.test(o.val())){errMsg+="	- an arrival location\n";errClass+="#"+o.get(0).id+","}}if(!i.test(u.val())||l>0&&l<f){errMsg+="	- a valid departure date\n";errClass+="#"+u.get(0).id+","}if(s.hasClass("flights")){if(!h&&!i.test(a.val())){errMsg+="	- a valid returning date\n";errClass+="#"+a.get(0).id+","}if(!h&&l>0&&c>0&&l>c){errMsg+="	- a greater returning date than the departure date\n";errClass+="#"+a.get(0).id+","}}else{if(!i.test(a.val())){errMsg+="	- a valid returning date\n";errClass+="#"+a.get(0).id+","}if(l>0&&c>0&&l>c){errMsg+="	- a greater returning date than the departure date\n";errClass+="#"+a.get(0).id+","}}if(errClass.match(/\,$/)){errClass=errClass.substr(0,errClass.length-1)}if(n){jQuery(errClass).addClass("err").focus(remErr)}if(t){var p=s.find("div.mrcList span.mSel");if(p.length<1){if(errMsg.length==0){alert("Please select at least two providers to compare their prices.");return false}else{errMsg+="Please select at least two providers to compare their prices.\n"}}}return errMsg.length?"Please enter:\n"+errMsg:false}function makeClassicSearchRequest(e){var t=validateSearchbox(e,true,true);if(t.length){alert(t);return false}ppups(e);jQuery(e).removeClass("submited");return true}function ppups(e){var t=typeof e!="undefined"?jQuery(e).parents("form").serializeArray():"";var n=createQueryString(e,t);if(!n)return false;var r=jQuery(e).parents("form");var i=1;var s="";if(r.hasClass("flights")){s="http://www.travelgrove.com/cgi-bin/link_counter_new.cgi?channel=3";i=TGSB.queryCodes["flights"]}if(r.hasClass("hotels")){s="http://www.travelgrove.com/cgi-bin/hotels/link_counter_new.cgi?channel=6";i=TGSB.queryCodes["hotels"]}if(r.hasClass("packages")){s="http://www.travelgrove.com/cgi-bin/vacation/link_counter_new.cgi?channel=7";i=TGSB.queryCodes["packages"]}if(r.hasClass("cars")){s="http://www.travelgrove.com/cgi-bin/cars/link_counter_new.cgi?channel=4";i=TGSB.queryCodes["cars"]}if(s.length==0)return false;var o=s.indexOf("?")>=0?"&":"?";s+=o+n+"&lang=def"+"&dateFormat=mm/dd/yyyy"+"&trafficSource=wpplugin"+"&searchsystem=us"+"&querycode="+i;r.find(".mrcList .mSel").each(function(){var e=jQuery(this);jump(s+"&merchant="+e.attr("title")+"&intitem="+e.attr("rel"))});return true}function jump(e){var t="left="+(popupWPos+=20)+",top="+popupWPos+",width="+screen.width*.8+",height="+screen.height*.8+",resizable = yes,scrollbars=yes, toolbar=yes, location=yes";var n=window.open(e,"_blank",t);if(!n)return false;return n}function makeMerchantsRequest(obj,showErrorMessages,addErrorClass){showErrorMessages=typeof showErrorMessages=="undefined"||!showErrorMessages?false:true;addErrorClass=typeof addErrorClass=="undefined"||!addErrorClass?false:true;var tgsb_querycode=0;var searchboxsize=jQuery(obj).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);var searchboxId=jQuery(obj).parents(".tg_searchbox").get(0).id;if(searchboxsize==null||searchboxsize[1]!="160x600"&&searchboxsize[1]!="300x250"&&searchboxsize[1]!="300x533"&&searchboxsize[1]!="728x90"&&searchboxsize[1]!="dynamic")return false;var searchbox=jQuery(obj).parents("form");var submitButton=searchbox.find("input.tgsb_submit_button");if(errMsg=validateSearchbox(obj,false,addErrorClass)){if(showErrorMessages)alert(errMsg);jQuery(submitButton).removeClass("submited");return false}var fields=typeof obj!="undefined"?jQuery(obj).parents("form").serializeArray():"";var queryString=createQueryString(obj,fields);if(!queryString)return false;var searchboxType=searchbox.attr("class").match(/(flights|hotels|packages|cars)/);if(searchboxType==null)return false;var merchantsContainer=searchbox.find("div.mrcList");if(typeof tgsb_searchboxesParams[searchboxId]=="undefined"){tgsb_searchboxesParams[searchboxId]={}}if(typeof tgsb_searchboxesParams[searchboxId][searchboxType]=="undefined"||tgsb_searchboxesParams[searchboxId][searchboxType]!=queryString){if(searchboxsize[1]!="dynamic")searchbox.find("div.formContent").addClass("nod");searchbox.find("div.help").addClass("nod");merchantsContainer.html(ajaxLoaders[searchboxsize[1]]);merchantsContainer.addClass("alCnt").removeClass("nod");var merchantsLimit=7;if(searchboxsize[1]=="728x90")merchantsLimit=6;if(searchboxsize[1]=="300x250")merchantsLimit=8;if(searchboxsize[1]=="300x533"||searchboxsize[1]=="dynamic")merchantsLimit=12;if(searchboxType[1]=="hotels"&&searchboxsize[1]=="160x600")merchantsLimit=10;tgsb_searchboxesParams[searchboxId][searchboxType]=queryString;if(searchbox.hasClass("flights")){tgsb_querycode=TGSB.queryCodes["flights"]}if(searchbox.hasClass("hotels")){tgsb_querycode=TGSB.queryCodes["hotels"]}if(searchbox.hasClass("packages")){tgsb_querycode=TGSB.queryCodes["packages"]}if(searchbox.hasClass("cars")){tgsb_querycode=TGSB.queryCodes["cars"]}jQuery.ajax({url:TG_Searchboxes_Variables.str_merchantsAjaxURL,type:"post",data:queryString+"&impId="+tgsb_querycode+"&merchants="+searchboxType[1]+"&sbsize="+searchboxsize[1]+"&limit="+merchantsLimit,dataType:"text",success:function(rsp){jsonObj=eval("("+rsp+")");merchantsContainer.removeClass("alCnt");merchantsContainer.html(jsonObj.merchants+(searchboxsize[1]=="300x250"||searchboxsize[1]=="728x90"?'<a href="#" class="tgBackToSearchbox">change this search</a>':""));var trackingPixel=searchbox.find("img.trackingPixel");if(!trackingPixel.length){merchantsContainer.after('<img class="trackingPixel" src="'+jsonObj.trackingPixel+'" width="1" height="1" />')}if(trackingPixel.length){trackingPixel.get(0).src=jsonObj.trackingPixel}var merchants=searchbox.find("div.mrcList").find("span");submitButton.addClass("tgsb_submit_button_cmp");submitButton.val("compare prices");submitButton.unbind("click").click(function(){makeClassicSearchRequest(this);return false});if(searchboxsize[1]=="300x250"||searchboxsize[1]=="728x90"||searchboxsize[1]=="dynamic"){searchbox.find("div.mrcList a.tgBackToSearchbox").click(function(){merchantsContainer.addClass("nod");searchbox.find("div.formContent").removeClass("nod");submitButton.removeClass("tgsb_submit_button_cmp");submitButton.val("search");submitButton.unbind("click").click(function(){makeMerchantsRequest(this);return false});return false})}merchants.each(function(){jQuery(this).click(function(){jQuery(this).toggleClass("mSel")})});jQuery(submitButton).removeClass("submited")}});return true}if(typeof tgsb_searchboxesParams[searchboxId][searchboxType]!="undefined"||tgsb_searchboxesParams[searchboxId][searchboxType]==queryString){if(searchboxsize[1]!="dynamic")searchbox.find("div.formContent").addClass("nod");submitButton.addClass("tgsb_submit_button_cmp");submitButton.val("compare prices");merchantsContainer.removeClass("nod");submitButton.unbind("click").click(function(){makeClassicSearchRequest(this);return false})}}function createQueryString(e,t){if(typeof t=="undefined"||t.length==0)return false;var n="";jQuery.each(t,function(r,i){if(TG_Searchboxes_Variables.str_dateFormat!="mm/dd/yy"&&(i.name=="dep_date"||i.name=="arr_date"||i.name=="start_date"||i.name=="end_date")){var s=jQuery(e).parents("form");tgsb_date=s.find("input[name="+i.name+"]:eq(0)").datepicker("getDate");n+=i.name+"="+setDateByDateFormat(tgsb_date)+(r<n.length-1?"&":"")}n+=n.match(i.name+"=")&&(i.name=="dep_date"||i.name=="arr_date"||i.name=="start_date"||i.name=="end_date")?"":i.name+"="+i.value+(r<t.length-1?"&":"")});return n}function makeImpressionTrackingRequest(e,t,n){if(typeof e=="undefined")return false;if(typeof n!="function")n=function(){};if(TGSB.queryCodes[e]==0){var r=createImpressionTrackingQueryString(t);if(r.length==0)return false;r+="&searchbox="+e;jQuery.getScript("http://www.travelgrove.com/js/affiliates/wpPluginImpTrack.php?"+r,n)}return true}function createImpressionTrackingQueryString(e){if(typeof e=="undefined")return"";var t=typeof e.find(".asFrom").val()!="undefined"?"from="+e.find(".asFrom").val()+"&":"";var n=typeof e.find(".asTo").val()!="undefined"?"to="+e.find(".asTo").val()+"&":"";var r="";var i="";if(typeof e.find(".depDate").val()!="undefined"){if(TG_Searchboxes_Variables.str_dateFormat!="mm/dd/yy"){r=e.find(".depDate").val();newtgsbDepDate=r.split("/");r=newtgsbDepDate[1]+"/"+newtgsbDepDate[0]+"/"+newtgsbDepDate[2]}r="dep_date="+r+"&"}if(typeof e.find(".retDate").val()!="undefined"){if(TG_Searchboxes_Variables.str_dateFormat!="mm/dd/yy"){i=e.find(".retDate").val();newtgsbRetDate=i.split("/");i=newtgsbRetDate[1]+"/"+newtgsbRetDate[0]+"/"+newtgsbRetDate[2]}i="ret_date="+i+"&"}var s=typeof e.find("input[name=idReferral]").val()!="undefined"?"idReferral="+e.find("input[name=idReferral]").val():999;var o=typeof e.find("input[name=subID]").val()!="undefined"?"subID="+e.find("input[name=subID]").val():106;return t+n+r+i+s+"&"+o+"&trafficSource=wpplugin"}function setDateByDateFormat(e){tgsb_day=e.getDate()<10?"0"+e.getDate():e.getDate();tgsb_month=e.getMonth();tgsb_month+=1;tgsb_month=tgsb_month<10?"0"+tgsb_month:tgsb_month;tgsb_year=e.getFullYear();return tgsb_month+"/"+tgsb_day+"/"+tgsb_year}function createDatepicker(e,t,n){jQuery("#"+e+", #"+t).each(function(){var n=jQuery(this);n.datepicker({minDate:0,maxDate:"2y",showOn:"both",buttonImage:TG_Searchboxes_Variables.str_CalendarURL,buttonImageOnly:true,dateFormat:TG_Searchboxes_Variables.str_dateFormat,onSelect:function(n,r){d1=jQuery(this).datepicker("getDate");if(this.id==e){d2=jQuery.datepicker.parseDate(TG_Searchboxes_Variables.str_dateFormat,jQuery("#"+t).val());jQuery("#"+t).datepicker("option","minDate",d1);if(d2&&d1>d2){d2.setTime(d1.getTime()+60*60*24*5*1e3);jQuery("#"+t).val(jQuery.datepicker.formatDate(TG_Searchboxes_Variables.str_dateFormat,d2))}}}})});if(typeof n=="object"&&n.length>0){if(n.length==1){var r=n.get(0).id;jQuery("#"+r).change(function(){jQuery("#"+t).attr("disabled",this.value.length?true:false)})}if(n.length==2){var i=n.get(0).id;var s=n.get(1).id;var o=jQuery("#"+t).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);jQuery("#"+s).change(function(){if(this.checked){jQuery("#"+t).attr("disabled",true);if(o!=null&&(o[1]=="160x600"||o[1]=="300x533"||o[1]=="dynamic"))makeMerchantsRequest(jQuery("#"+t).get(0))}});jQuery("#"+i).change(function(){if(this.checked){jQuery("#"+t).attr("disabled",false);if(o!=null&&(o[1]=="160x600"||o[1]=="300x533"||o[1]=="dynamic"))makeMerchantsRequest(jQuery("#"+t).get(0))}})}}}function tgsb_setSearchboxDetails(e,t,n,r,i,s){if(typeof e=="undefined"||typeof t=="undefined"||typeof n=="undefined"||typeof r=="undefined"||typeof i=="undefined"||typeof s=="undefined")return false;var o=jQuery("#content").find("div.tg_searchbox");if(!o.find("ul.tg_tabs li span.sel").hasClass(e))return false;var u=o.find("form.sel");var a=u.find("input.tgsb_submit_button");var f=u.find("input.asFrom");var l=u.find("input.asTo");var c=u.find("input.depDate");var h=u.find("input.depDate");if(typeof f=="object"&&f.length>0){f.val(n)}if(typeof l=="object"&&l.length>0){l.val(r)}if(typeof c=="object"&&c.length>0){c.val(i)}if(typeof h=="object"&&h.length>0){h.val(s)}if(e=="flights"){var p=false;var p=currentForm.hasClass("flights")?jQuery(this).find("input[name=oneway]"):false;if(typeof p=="object"&&p.length>0){var d=p.get(0).id;var v=p.get(1).id;if(!t){jQuery("#"+v).click()}}}makeMerchantsRequest(a.get(0));return false}function tgsb_initSingleSearchbox(e){e=jQuery(e).filter(":not(.tg_searchbox_initialized)");e.addClass("tg_searchbox_initialized");if(e.length==0)return false;e.find(".tgsb_addAS").each(function(){jQuery(this).focus(inputFocus).blur(inputBlur);new AS(this.id,ASoptions)});e.find(".tgsb_addASH").each(function(){jQuery(this).focus(inputFocus).blur(inputBlur);new AS(this.id,hotelASoptions)});e.find("ul.tg_tabs li span").click(function(){selectedTab=jQuery(this).attr("class").match(/^[a-z]+/);var e=jQuery(this).parents("div.tg_searchbox:eq(0)");e.find("ul.tg_tabs li span").removeClass("sel");e.find("ul.tg_tabs li span."+selectedTab).addClass("sel");e.find("div.tg_container form").removeClass("sel");e.find("div.tg_container form."+selectedTab).addClass("sel");var t=e.find("div.tg_container form.sel");var n=t.find("input.tgsb_submit_button");makeImpressionTrackingRequest(selectedTab,t,function(){var e=t.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);if(e[1]=="160x600"||e[1]=="300x533"||e[1]=="dynamic")makeMerchantsRequest(n.get(0),false,false)})});e.find("form").each(function(){var e=jQuery(this);var t=e.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);var n=e.find("input.tgsb_submit_button");if(e.hasClass("sel")){selectedTab=e.attr("class").match(/^[a-z]+/);makeImpressionTrackingRequest(selectedTab,e,function(){var t=e.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);if(t[1]=="160x600"||t[1]=="300x533"||t[1]=="dynamic")makeMerchantsRequest(n.get(0),false,false)})}var r=e.find("select[name=class]");if(r.length){r.change(function(){makeMerchantsRequest(this)})}var i=e.find(".tgsb_addDP");var s=i.get(0).id;var o=i.get(1).id;var u=false;var u=e.hasClass("flights")?e.find("input[name=oneway], select[name=oneway]"):false;createDatepicker(s,o,u);e.submit(function(){if(n.hasClass("submited"))return false;n.addClass("submited");makeMerchantsRequest(n.get(0),true,true);return false})})}var popupWPos=0;var ajaxLoaders;var ASoptions;var hotelASoptions;var tgsb_searchboxesParams={};TGSB=new TGSearchboxes;jQuery(function(){ajaxLoaders={"160x600":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"300x250":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"300x533":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"728x90":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />',dynamic:'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />'};ASoptions={delay:175,timeout:5e3,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",json:true,frameForIE:true,ajaxParams:{action:"",json:true,lng:"def",dsgn:"flg",addtag:"em",citytype:"airports",domainPrefix:true},autoSelect:true,offsety:0,format:function(e){return e.innerHTML.replace(/<\/?[a-z]+[^>]*>/gi,"").replace(/(.*),(.*)\((.*)\)/,"$1 ($3)")},callback:function(e,t){var n=jQuery(t.fld).parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/);if(n==null)makeMerchantsRequest(t.fld)},errorHandler:function(e){jQuery(e.fld).addClass("err").focus(remErr)}};hotelASoptions={delay:175,timeout:5e3,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",json:true,frameForIE:true,ajaxParams:{action:"",json:true,lng:"def",dsgn:"flg",addtag:"em",citytype:"cities",domainPrefix:true},autoSelect:true,offsety:0,format:function(e){return e.innerHTML.replace(/<\/?[^>]+>/gi,"").replace(/(.*),(.*) \((.*)\)/,"$1,$2")},callback:function(e,t){var n=jQuery(t.fld);n.parents("div.tg_searchbox").find(".tgsb_addDest").val(e.id);var r=n.parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/);if(r==null)makeMerchantsRequest(t.fld)}};tgsb_initSingleSearchbox(".tg_searchbox");if(typeof TGSB_placeholders!="undefined"&&TGSB_placeholders.length>0){for(var e=0;e<TGSB_placeholders.length;e++)replacePlaceholder(TGSB_placeholders[e].placeholder,TGSB_placeholders[e].html)}})})(tgsb_myjquery)
(function(u){var v=0;var w;var x;var y;var z={};var A;var B=false;function TGSearchboxes(){this.queryCodes={flights:0,hotels:0,cars:0,packages:0};this.set=function(a,b){this.queryCodes[a]=b;return true};this.replacePlaceholder=replacePlaceholder};TGSB=new TGSearchboxes();function remErr(){u(this).removeClass("err").unbind('focus',remErr)};function inputFocus(a){if(this.value==this.defaultValue)this.value='';else this.select()};function inputBlur(a){if(this.value=='')this.value=this.defaultValue};function replacePlaceholder(c,d){u(function(){var a=u(d);var b=u('span#'+c);if(b.length==0)return false;b.replaceWith(a);tgsb_initSingleSearchbox(a)})};function validateSearchbox(a,b,c){b=(typeof(b)=='undefined'||!b)?false:true;c=(typeof(c)=='undefined'||!c)?false:true;errMsg='';errClass='';var d=/^.*\s\(...\)$/i;var e=/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/;var f=u(a).parents('form');if(!f.hasClass('hotels')){departure=f.find('input.asFrom')};var g=f.find('input.asTo');var h=f.find('input.depDate');var i=f.find('input.retDate');var j=new Date();var k=h.datepicker('getDate');var l=i.datepicker('getDate');if(f.hasClass('flights')){rtowInputs=f.find('input[name=oneway]');var m=false;if(typeof(rtowInputs.get(0))!='undefined'&&typeof(rtowInputs.get(1))!='undefined'){rt=rtowInputs.get(0).id;ow=rtowInputs.get(1).id;m=u('#'+ow).attr('checked')}};if(!f.hasClass('hotels')){if(!d.test(departure.val())){errMsg+="\t- a departure location\n";errClass+='#'+departure.get(0).id+','}};if(f.hasClass('hotels')){if(g.val().length<3){errMsg+="\t- an arrival location\n";errClass+='#'+g.get(0).id+','}}else{if(!d.test(g.val())){errMsg+="\t- an arrival location\n";errClass+='#'+g.get(0).id+','}};if(!e.test(h.val())||(k>0&&k<j)){errMsg+="\t- a valid departure date\n";errClass+='#'+h.get(0).id+','};if(f.hasClass('flights')){if(!m&&!e.test(i.val())){errMsg+="\t- a valid returning date\n";errClass+='#'+i.get(0).id+','};if(!m&&k>0&&l>0&&k>l){errMsg+="\t- a greater returning date than the departure date\n";errClass+='#'+i.get(0).id+','}}else{if(!e.test(i.val())){errMsg+="\t- a valid returning date\n";errClass+='#'+i.get(0).id+','};if(k>0&&l>0&&k>l){errMsg+="\t- a greater returning date than the departure date\n";errClass+='#'+i.get(0).id+','}};if(errClass.match(/\,$/)){errClass=errClass.substr(0,(errClass.length-1))};if(c){u(errClass).addClass("err").focus(remErr)};if(b){var n=f.find('div.mrcList span.mSel');if(n.length<1){if(errMsg.length==0){alert('Please select at least two providers to compare their prices.');return false}else{errMsg+="Please select at least two providers to compare their prices.\n"}}};return errMsg.length?"Please enter:\n"+errMsg:false};function makeClassicSearchRequest(a){var b=validateSearchbox(a,true,true);if(b.length){alert(b);return false};ppups(a);u(a).removeClass('submited');return true};function ppups(b){var c=(typeof(b)!='undefined')?u(b).parents('form').serializeArray():'';var d=createQueryString(b,c);if(!d)return false;var e=u(b).parents('form');var f=1;var g='';if(e.hasClass('flights')){g='http://www.travelgrove.com/cgi-bin/link_counter_new.cgi?channel=3';f=TGSB.queryCodes['flights']};if(e.hasClass('hotels')){g='http://www.travelgrove.com/cgi-bin/hotels/link_counter_new.cgi?channel=6';f=TGSB.queryCodes['hotels']};if(e.hasClass('packages')){g='http://www.travelgrove.com/cgi-bin/vacation/link_counter_new.cgi?channel=7';f=TGSB.queryCodes['packages']};if(e.hasClass('cars')){g='http://www.travelgrove.com/cgi-bin/cars/link_counter_new.cgi?channel=4';f=TGSB.queryCodes['cars']};if(g.length==0)return false;var h=g.indexOf('?')>=0?'&':'?';g+=h+d+'&lang=def'+'&dateFormat=mm/dd/yyyy'+'&trafficSource=wpplugin'+'&searchsystem=us'+'&querycode='+f;var i=0;var j=e.find(".mrcList .mSel");j.each(function(){var t=u(this);var a=B?t.attr('title')+'_'+t.attr('rel'):'';A.open(g+'&merchant='+t.attr('title')+'&intitem='+t.attr('rel'),a,i,j.length);i++});return true};function jump(a){var b="left="+(v+=20)+",top="+v+",width="+(screen.width*0.8)+",height="+(screen.height*0.8)+",resizable = yes,scrollbars=yes, toolbar=yes, location=yes";var c=window.open(a,"_blank",b);if(!c)return false;return c};function makeMerchantsRequest(g,h,i){h=(typeof(h)=='undefined'||!h)?false:true;i=(typeof(i)=='undefined'||!i)?false:true;var j=0;var k=u(g).parents('.tg_searchbox').attr('class').match(/m(160x600|300x250|300x533|728x90|dynamic)/);var l=u(g).parents('.tg_searchbox').get(0).id;if(k==null||(k[1]!='160x600'&&k[1]!='300x250'&&k[1]!='300x533'&&k[1]!='728x90'&&k[1]!='dynamic'))return false;var m=u(g).parents('form');var n=m.find('input.tgsb_submit_button');if((errMsg=validateSearchbox(g,false,i))){if(h)alert(errMsg);u(n).removeClass('submited');return false};var o=(typeof(g)!='undefined')?u(g).parents('form').serializeArray():'';var p=createQueryString(g,o);if(!p)return false;var q=m.attr('class').match(/(flights|hotels|packages|cars)/);if(q==null)return false;var r=m.find('div.mrcList');if(typeof(z[l])=='undefined'){z[l]={}};if(typeof(z[l][q])=='undefined'||z[l][q]!=p){if(k[1]!='dynamic')m.find('div.formContent').addClass('nod');m.find('div.help').addClass('nod');r.html(w[k[1]]);r.addClass('alCnt').removeClass('nod');var s=7;if(k[1]=='728x90')s=6;if(k[1]=='300x250')s=8;if(k[1]=='300x533'||k[1]=='dynamic')s=12;if(q[1]=='hotels'&&k[1]=='160x600')s=10;z[l][q]=p;if(m.hasClass('flights')){j=TGSB.queryCodes['flights']};if(m.hasClass('hotels')){j=TGSB.queryCodes['hotels']};if(m.hasClass('packages')){j=TGSB.queryCodes['packages']};if(m.hasClass('cars')){j=TGSB.queryCodes['cars']};u.ajax({url:TG_Searchboxes_Variables.str_merchantsAjaxURL,type:'post',data:p+'&impId='+j+'&merchants='+q[1]+'&sbsize='+k[1]+'&limit='+s,dataType:'text',success:function(d){jsonObj=eval('('+d+')');r.removeClass('alCnt');r.html(jsonObj.merchants+((k[1]=='300x250'||k[1]=='728x90')?'<a href="#" class="tgBackToSearchbox">change this search</a>':''));var e=m.find('img.trackingPixel');if(!e.length){r.after('<img class="trackingPixel" src="'+jsonObj.trackingPixel+'" width="1" height="1" />')};if(e.length){e.get(0).src=jsonObj.trackingPixel};var f=m.find('div.mrcList').find('span');n.addClass('tgsb_submit_button_cmp');n.val('compare prices');n.unbind('click').click(function(){makeClassicSearchRequest(this);return false});if(k[1]=='300x250'||k[1]=='728x90'||k[1]=='dynamic'){m.find('div.mrcList a.tgBackToSearchbox').click(function(){r.addClass('nod');m.find('div.formContent').removeClass('nod');n.removeClass('tgsb_submit_button_cmp');n.val('search');n.unbind('click').click(function(){makeMerchantsRequest(this);return false});return false})};f.click(function(){var t=u(this);t.toggleClass('mSel');if(B){var a=t.attr('title')+'_'+t.attr('rel');if(!t.hasClass('mSel')){A.close(a)}else{var b=$.extend({},A.opts);A.setOptions({'popUnder':true,'style':'fix'});var c=A.open('about:blank',a,0,1,1);A.opts=b}}});u(n).removeClass('submited')}});return true};if(typeof(z[l][q])!='undefined'||z[l][q]==p){if(k[1]!='dynamic')m.find('div.formContent').addClass('nod');n.addClass('tgsb_submit_button_cmp');n.val('compare prices');r.removeClass('nod');n.unbind('click').click(function(){makeClassicSearchRequest(this);return false})}};function createQueryString(c,d){if(typeof(d)=='undefined'||d.length==0)return false;var e='';u.each(d,function(i,a){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'&&(a.name=='dep_date'||a.name=='arr_date'||a.name=='start_date'||a.name=='end_date')){var b=u(c).parents('form');tgsb_date=b.find('input[name='+a.name+']:eq(0)').datepicker('getDate');e+=a.name+'='+setDateByDateFormat(tgsb_date)+((i<(e.length-1))?'&':'')};e+=(e.match(a.name+'=')&&(a.name=='dep_date'||a.name=='arr_date'||a.name=='start_date'||a.name=='end_date'))?'':a.name+'='+a.value+((i<(d.length-1))?'&':'')});return e};function makeImpressionTrackingRequest(a,b,c){if(typeof(a)=='undefined')return false;if(typeof(c)!='function')c=function(){};if(TGSB.queryCodes[a]==0){var d=createImpressionTrackingQueryString(b);if(d.length==0)return false;d+='&searchbox='+a;u.getScript('http://www.travelgrove.com/js/affiliates/wpPluginImpTrack.php?'+d,c)};return true};function createImpressionTrackingQueryString(a){if(typeof(a)=='undefined')return'';var b=(typeof(a.find('.asFrom').val())!='undefined')?'from='+a.find('.asFrom').val()+'&':'';var c=(typeof(a.find('.asTo').val())!='undefined')?'to='+a.find('.asTo').val()+'&':'';var d='';var e='';if((typeof(a.find('.depDate').val())!='undefined')){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'){d=a.find('.depDate').val();newtgsbDepDate=d.split('/');d=newtgsbDepDate[1]+'/'+newtgsbDepDate[0]+'/'+newtgsbDepDate[2]};d='dep_date='+d+'&'};if((typeof(a.find('.retDate').val())!='undefined')){if(TG_Searchboxes_Variables.str_dateFormat!='mm/dd/yy'){e=a.find('.retDate').val();newtgsbRetDate=e.split('/');e=newtgsbRetDate[1]+'/'+newtgsbRetDate[0]+'/'+newtgsbRetDate[2]};e='ret_date='+e+'&'};var f=(typeof(a.find('input[name=idReferral]').val())!='undefined')?'idReferral='+a.find('input[name=idReferral]').val():999;var g=(typeof(a.find('input[name=subID]').val())!='undefined')?'subID='+a.find('input[name=subID]').val():106;return b+c+d+e+f+'&'+g+'&trafficSource=wpplugin'};function setDateByDateFormat(a){tgsb_day=(a.getDate()<10)?'0'+a.getDate():a.getDate();tgsb_month=a.getMonth();tgsb_month+=1;tgsb_month=(tgsb_month<10)?'0'+tgsb_month:tgsb_month;tgsb_year=a.getFullYear();return tgsb_month+'/'+tgsb_day+'/'+tgsb_year};function createDatepicker(d,e,f){u('#'+d+', #'+e).each(function(){var c=u(this);c.datepicker({minDate:0,maxDate:"2y",showOn:"both",buttonImage:TG_Searchboxes_Variables.str_CalendarURL,buttonImageOnly:true,dateFormat:TG_Searchboxes_Variables.str_dateFormat,onSelect:function(a,b){d1=u(this).datepicker("getDate");if(this.id==d){d2=u.datepicker.parseDate(TG_Searchboxes_Variables.str_dateFormat,u('#'+e).val());u("#"+e).datepicker('option','minDate',d1);if(d2&&d1>d2){d2.setTime(d1.getTime()+60*60*24*5*1000);u("#"+e).val(u.datepicker.formatDate(TG_Searchboxes_Variables.str_dateFormat,d2))}}}})});if(typeof(f)=='object'&&f.length>0){if(f.length==1){var g=f.get(0).id;u('#'+g).change(function(){u('#'+e).attr('disabled',((this.value.length)?true:false))})};if(f.length==2){var h=f.get(0).id;var i=f.get(1).id;var j=u('#'+e).parents('.tg_searchbox').attr('class').match(/m(160x600|300x250|300x533|728x90|dynamic)/);u('#'+i).change(function(){if(this.checked){u('#'+e).attr('disabled',true);if(j!=null&&(j[1]=='160x600'||j[1]=='300x533'||j[1]=='dynamic'))makeMerchantsRequest(u('#'+e).get(0))}});u('#'+h).change(function(){if(this.checked){u('#'+e).attr('disabled',false);if(j!=null&&(j[1]=='160x600'||j[1]=='300x533'||j[1]=='dynamic'))makeMerchantsRequest(u('#'+e).get(0))}})}}};function tgsb_setSearchboxDetails(a,b,c,d,e,f){if(typeof(a)=='undefined'||typeof(b)=='undefined'||typeof(c)=='undefined'||typeof(d)=='undefined'||typeof(e)=='undefined'||typeof(f)=='undefined')return false;var g=u('#content').find('div.tg_searchbox');if(!g.find('ul.tg_tabs li span.sel').hasClass(a))return false;var h=g.find('form.sel');var i=h.find('input.tgsb_submit_button');var j=h.find('input.asFrom');var k=h.find('input.asTo');var l=h.find('input.depDate');var m=h.find('input.depDate');if(typeof(j)=='object'&&j.length>0){j.val(c)};if(typeof(k)=='object'&&k.length>0){k.val(d)};if(typeof(l)=='object'&&l.length>0){l.val(e)};if(typeof(m)=='object'&&m.length>0){m.val(f)};if(a=='flights'){var n=false;var n=currentForm.hasClass('flights')?u(this).find('input[name=oneway]'):false;if(typeof(n)=='object'&&n.length>0){var o=n.get(0).id;var p=n.get(1).id;if(!b){u('#'+p).click()}}};makeMerchantsRequest(i.get(0));return false};function tgsb_initSingleSearchbox(j){j=u(j).filter(':not(.tg_searchbox_initialized)');j.addClass('tg_searchbox_initialized');if(j.length==0)return false;j.find(".tgsb_addAS").each(function(){u(this).focus(inputFocus).blur(inputBlur);new AS(this.id,x)});j.find(".tgsb_addASH").each(function(){u(this).focus(inputFocus).blur(inputBlur);new AS(this.id,y)});j.find('ul.tg_tabs li span').click(function(){selectedTab=u(this).attr('class').match(/^[a-z]+/);var b=u(this).parents("div.tg_searchbox:eq(0)");b.find('ul.tg_tabs li span').removeClass('sel');b.find('ul.tg_tabs li span.'+selectedTab).addClass('sel');b.find('div.tg_container form').removeClass('sel');b.find('div.tg_container form.'+selectedTab).addClass('sel');var c=b.find('div.tg_container form.sel');var d=c.find('input.tgsb_submit_button');makeImpressionTrackingRequest(selectedTab,c,function(){var a=c.parents('.tg_searchbox').attr('class').match(/m(160x600|300x250|300x533|728x90|dynamic)/);if(a[1]=='160x600'||a[1]=='300x533'||a[1]=='dynamic')makeMerchantsRequest(d.get(0),false,false)})});j.find('form').each(function(){var b=u(this);var c=b.parents('.tg_searchbox').attr('class').match(/m(160x600|300x250|300x533|728x90|dynamic)/);var d=b.find('input.tgsb_submit_button');if(b.hasClass('sel')){selectedTab=b.attr('class').match(/^[a-z]+/);makeImpressionTrackingRequest(selectedTab,b,function(){var a=b.parents('.tg_searchbox').attr('class').match(/m(160x600|300x250|300x533|728x90|dynamic)/);if(a[1]=='160x600'||a[1]=='300x533'||a[1]=='dynamic')makeMerchantsRequest(d.get(0),false,false)})};var e=b.find('select[name=class]');if(e.length){e.change(function(){makeMerchantsRequest(this)})};var f=b.find(".tgsb_addDP");var g=f.get(0).id;var h=f.get(1).id;var i=false;var i=b.hasClass('flights')?b.find('input[name=oneway], select[name=oneway]'):false;createDatepicker(g,h,i);A.wrapButton(d.get(0));b.submit(function(){if(d.hasClass('submited'))return false;d.addClass('submited');makeMerchantsRequest(d.get(0),true,true);return false})})}u(function(){w={'160x600':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','300x250':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','300x533':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />','728x90':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />','dynamic':'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />'};x={delay:175,timeout:5000,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:'tgsb_as_load',className:'tgsb_as tgsb_asMargin',json:true,frameForIE:true,ajaxParams:{action:'',json:true,lng:'def',dsgn:'flg',addtag:'em',citytype:'airports',domainPrefix:true},autoSelect:true,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[a-z]+[^>]*>/gi,'').replace(/(.*),(.*)\((.*)\)/,'$1 ($3)')},callback:function(a,b){var c=u(b.fld).parents('.tg_searchbox').attr('class').match(/(300x250|728x90)/);if(c==null)makeMerchantsRequest(b.fld)},errorHandler:function(a){u(a.fld).addClass("err").focus(remErr)}};y={delay:175,timeout:5000,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:'tgsb_as_load',className:'tgsb_as tgsb_asMargin',json:true,frameForIE:true,ajaxParams:{action:'',json:true,lng:'def',dsgn:'flg',addtag:'em',citytype:'cities',domainPrefix:true},autoSelect:true,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[^>]+>/gi,'').replace(/(.*),(.*) \((.*)\)/,'$1,$2')},callback:function(a,b){var c=u(b.fld);c.parents('div.tg_searchbox').find(".tgsb_addDest").val(a.id);var d=c.parents('.tg_searchbox').attr('class').match(/(300x250|728x90)/);if(d==null)makeMerchantsRequest(b.fld)}};A=new TGSB_WindowOpener({chromePPBmode:window.chrome?true:false,maxScreenWidth:screen.width,maxScreenHeight:screen.height,winWidth:parseInt(screen.width*0.8),blankPageHtml:'<div style="margin:10px auto;width:100%;text-align:center;">'+'<img src="'+TG_Searchboxes_Variables.plugin_url+'/images/please-wait.jpg">'+'</div>',position:{left:0,top:0,width:500,height:180}});tgsb_initSingleSearchbox('.tg_searchbox');if(typeof(TGSB_placeholders)!='undefined'&&TGSB_placeholders.length>0){for(var i=0;i<TGSB_placeholders.length;i++)replacePlaceholder(TGSB_placeholders[i].placeholder,TGSB_placeholders[i].html)}})})(tgsb_myjquery);
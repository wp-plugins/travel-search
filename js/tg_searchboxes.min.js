(function(f){function I(){p=new TGSB_WindowOpener({chromePPBmode:window.chrome?!0:!1,popUnder:!1,style:"cascade",position:{left:0,top:0,width:460,height:485},buildPlaceHolderUrl:function(a){},buildPlaceHolderHtml:function(a){a=f(a);var e=a.parents(".tg_searchbox:eq(0)").attr("id"),d=a.attr("rel").replace(/[^0-9]+/g,""),c=a.attr("title"),b=a.children("img").attr("src").replace(/^.*\/([^\/]+)$/,"$1");a=t(a,!1,!1)?"":w(a,c,d);e="<script type='text/javascript'>var mName='"+c+"';var mId="+parseInt(d)+
";var mLogo='"+b+"';var sb='"+e+"';var redirectLink='"+a+"'\x3c/script>";return"<html><head><title>Opening "+c+"</title>"+e+("<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'>\x3c/script><script type='text/javascript' src='"+TG_Searchboxes_Variables.plugin_url+"/js/placeholder.min.js'>\x3c/script>")+"</head><body></body></html>"},buildWindowName:function(a){a=f(a);var e=a.attr("rel").replace(/[^0-9]+/g,"");return a.attr("title")+"_"+e}});x=f.browser.msie||
p.isChromeMinVer(30)}function u(){f(this).removeClass("err").unbind("focus",u)}function y(a){this.value==this.defaultValue?this.value="":this.select()}function z(a){""==this.value&&(this.value=this.defaultValue)}function A(a,e){f(function(){var d=f(e),c=f("span#"+a);if(0==c.length)return!1;c.replaceWith(d);B(d)})}function t(a,e,d){e="undefined"!=typeof e&&e?!0:!1;d="undefined"!=typeof d&&d?!0:!1;var c="",b="",g=/^.*\s\(...\)$/i,h=/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/;a=f(a).parents("form");var k;a.hasClass("hotels")||
(k=a.find("input.asFrom"));var m=a.find("input.asTo"),v=a.find("input.depDate"),q=a.find("input.retDate"),n=new Date,l=v.datepicker("getDate"),p=q.datepicker("getDate");if(!a.hasClass("cruises")){if(a.hasClass("flights")){var s=a.find("input[name=oneway]"),r=!1;"undefined"!=typeof s.get(0)&&"undefined"!=typeof s.get(1)&&(s.get(0),r=s.get(1).id,r=f("#"+r).attr("checked"))}a.hasClass("hotels")||g.test(k.val())||(c+="\t- a departure location\n",b+="#"+k.get(0).id+",");a.hasClass("hotels")?3>m.val().length&&
(c+="\t- an arrival location\n",b+="#"+m.get(0).id+","):g.test(m.val())||(c+="\t- an arrival location\n",b+="#"+m.get(0).id+",");if(!h.test(v.val())||0<l&&l<n)c+="\t- a valid departure date\n",b+="#"+v.get(0).id+",";a.hasClass("flights")?(r||h.test(q.val())||(c+="\t- a valid returning date\n",b+="#"+q.get(0).id+","),!r&&0<l&&0<p&&l>p&&(c+="\t- a greater returning date than the departure date\n",b+="#"+q.get(0).id+",")):(h.test(q.val())||(c+="\t- a valid returning date\n",b+="#"+q.get(0).id+","),0<
l&&0<p&&l>p&&(c+="\t- a greater returning date than the departure date\n",b+="#"+q.get(0).id+","))}b.match(/\,$/)&&(b=b.substr(0,b.length-1));d&&f(b).addClass("err").focus(u);if(e&&1>a.find("div.mrcList span.mSel").length){if(0==c.length)return alert("Please select at least two providers to compare their prices."),!1;c+="Please select at least two providers to compare their prices.\n"}return c.length?"Please enter:\n"+c:!1}function C(a){var e=t(a,!0,!0);if(e.length)return alert(e),!1;J(a);f(a).removeClass("submited");
return!0}function w(a,e,d){if(!a||!e||!d)return!1;var c="undefined"!=typeof a?f(a).parents("form").serializeArray():"",c=D(a,c);if(!c)return!1;var b=f(a).parents("form");a=1;var g="";b.hasClass("flights")&&(g="http://www.travelgrove.com/cgi-bin/link_counter_new.cgi?channel=3",a=TGSB.queryCodes.flights);b.hasClass("hotels")&&(g="http://www.travelgrove.com/cgi-bin/hotels/link_counter_new.cgi?channel=6",a=TGSB.queryCodes.hotels);b.hasClass("packages")&&(g="http://www.travelgrove.com/cgi-bin/vacation/link_counter_new.cgi?channel=7",
a=TGSB.queryCodes.packages);b.hasClass("cars")&&(g="http://www.travelgrove.com/cgi-bin/cars/link_counter_new.cgi?channel=4",a=TGSB.queryCodes.cars);b.hasClass("cruises")&&(g="http://www.travelgrove.com/cgi-bin/cruises/link_counter_new.cgi?channel=5",a=TGSB.queryCodes.cruises);if(0==g.length)return!1;b=0<=g.indexOf("?")?"&":"?";return g+(b+c+"&lang=def&dateFormat=mm/dd/yyyy&trafficSource=wpplugin&searchsystem=us&querycode="+a+"&merchant="+e+"&intitem="+d)}function J(a){if(!a)return!1;var e=0,d=f(a).parents("form:eq(0)").find(".mrcList .mSel");
d.each(function(){var c=f(this),b=c.attr("title"),c=c.attr("rel"),b=w(a,b,c);p.open(b,this,e++,d.length)});return!0}function n(a,e,d){e="undefined"!=typeof e&&e?!0:!1;d="undefined"!=typeof d&&d?!0:!1;var c=0,b=f(a).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/),g=f(a).parents(".tg_searchbox").get(0).id;if(null==b||"160x600"!=b[1]&&"300x250"!=b[1]&&"300x533"!=b[1]&&"728x90"!=b[1]&&"dynamic"!=b[1])return!1;var h=f(a).parents("form"),k=h.find("input.tgsb_submit_button");
if(errMsg=t(a,!1,d))return e&&alert(errMsg),f(k).removeClass("submited"),!1;e="undefined"!=typeof a?f(a).parents("form").serializeArray():"";a=D(a,e);if(!a)return!1;e=h.attr("class").match(/(flights|hotels|packages|cars|cruises)/);if(null==e)return!1;var m=h.find("div.mrcList");"undefined"==typeof l[g]&&(l[g]={});if("undefined"==typeof l[g][e]||l[g][e]!=a){"dynamic"!=b[1]&&h.find("div.formContent").addClass("nod");h.find("div.help").addClass("nod");m.html(E[b[1]]);m.addClass("alCnt").removeClass("nod");
d=7;"728x90"==b[1]&&(d=6);"300x250"==b[1]&&(d=8);if("300x533"==b[1]||"dynamic"==b[1])d=12;"hotels"==e[1]&&"160x600"==b[1]&&(d=10);l[g][e]=a;h.hasClass("flights")&&(c=TGSB.queryCodes.flights);h.hasClass("hotels")&&(c=TGSB.queryCodes.hotels);h.hasClass("packages")&&(c=TGSB.queryCodes.packages);h.hasClass("cars")&&(c=TGSB.queryCodes.cars);h.hasClass("cruises")&&(c=TGSB.queryCodes.cruises);f.ajax({url:TG_Searchboxes_Variables.str_merchantsAjaxURL,type:"post",data:a+"&impId="+c+"&merchants="+e[1]+"&sbsize="+
b[1]+"&limit="+d,dataType:"text",success:function(a){a=eval("("+a+")");m.removeClass("alCnt");m.html(a.merchants+("300x250"==b[1]||"728x90"==b[1]?'<a href="#" class="tgBackToSearchbox">change this search</a>':""));var e=h.find("img.trackingPixel");e.length||m.after('<img class="trackingPixel" src="'+a.trackingPixel+'" width="1" height="1" />');e.length&&(e.get(0).src=a.trackingPixel);a=h.find("div.mrcList").find("span");k.addClass("tgsb_submit_button_cmp");k.val("compare prices");k.unbind("click").click(function(){C(this);
return!1});"300x250"!=b[1]&&"728x90"!=b[1]&&"dynamic"!=b[1]||h.find("div.mrcList a.tgBackToSearchbox").click(function(){m.addClass("nod");h.find("div.formContent").removeClass("nod");k.removeClass("tgsb_submit_button_cmp");k.val("search");k.unbind("click").click(function(){n(this);return!1});return!1});a.click(function(){var a=f(this);a.toggleClass("mSel");if(!x)return!0;a.hasClass("mSel")?p.openPlaceholder(a):p.closePlaceholder(a)});a.filter('[rel="5760"]').not(".mSel").click();f(k).removeClass("submited")}});
return!0}if("undefined"!=typeof l[g][e]||l[g][e]==a)"dynamic"!=b[1]&&h.find("div.formContent").addClass("nod"),k.addClass("tgsb_submit_button_cmp"),k.val("compare prices"),m.removeClass("nod"),k.unbind("click").click(function(){C(this);return!1})}function D(a,e){if("undefined"==typeof e||0==e.length)return!1;var d="";f.each(e,function(c,b){if("mm/dd/yy"!=TG_Searchboxes_Variables.str_dateFormat&&("dep_date"==b.name||"arr_date"==b.name||"start_date"==b.name||"end_date"==b.name)){var g=f(a).parents("form").find("input[name="+
b.name+"]:eq(0)").datepicker("getDate"),h=d,k=b.name+"=";tgsb_day=10>g.getDate()?"0"+g.getDate():g.getDate();tgsb_month=g.getMonth();tgsb_month+=1;tgsb_month=10>tgsb_month?"0"+tgsb_month:tgsb_month;tgsb_year=g.getFullYear();d=h+(k+(tgsb_month+"/"+tgsb_day+"/"+tgsb_year)+(c<d.length-1?"&":""))}d+=!d.match(b.name+"=")||"dep_date"!=b.name&&"arr_date"!=b.name&&"start_date"!=b.name&&"end_date"!=b.name?b.name+"="+b.value+(c<e.length-1?"&":""):""});return d}function F(a,e,d){if("undefined"==typeof a)return!1;
"function"!=typeof d&&(d=function(){});if(0==TGSB.queryCodes[a]||!TGSB.queryCodes[a]){e=K(e);if(0==e.length)return!1;f.getScript("http://www.travelgrove.com/js/affiliates/wpPluginImpTrack.php?"+(e+("&searchbox="+a)),d)}return!0}function K(a){if("undefined"==typeof a)return"";var e="undefined"!=typeof a.find(".asFrom").val()?"from="+a.find(".asFrom").val()+"&":"",d="undefined"!=typeof a.find(".asTo").val()?"to="+a.find(".asTo").val()+"&":"",c="",b="";"undefined"!=typeof a.find(".depDate").val()&&("mm/dd/yy"!=
TG_Searchboxes_Variables.str_dateFormat&&(c=a.find(".depDate").val(),newtgsbDepDate=c.split("/"),c=newtgsbDepDate[1]+"/"+newtgsbDepDate[0]+"/"+newtgsbDepDate[2]),c="dep_date="+c+"&");"undefined"!=typeof a.find(".retDate").val()&&("mm/dd/yy"!=TG_Searchboxes_Variables.str_dateFormat&&(b=a.find(".retDate").val(),newtgsbRetDate=b.split("/"),b=newtgsbRetDate[1]+"/"+newtgsbRetDate[0]+"/"+newtgsbRetDate[2]),b="ret_date="+b+"&");var f="undefined"!=typeof a.find("input[name=idReferral]").val()?"idReferral="+
a.find("input[name=idReferral]").val():999;a="undefined"!=typeof a.find("input[name=subID]").val()?"subID="+a.find("input[name=subID]").val():106;return e+d+c+b+f+"&"+a+"&trafficSource=wpplugin"}function L(a,e,d){f("#"+a+", #"+e).each(function(){f(this).datepicker({minDate:0,maxDate:"2y",showOn:"both",buttonImage:TG_Searchboxes_Variables.str_CalendarURL,buttonImageOnly:!0,dateFormat:TG_Searchboxes_Variables.str_dateFormat,onSelect:function(b,c){d1=f(this).datepicker("getDate");this.id==a&&(d2=f.datepicker.parseDate(TG_Searchboxes_Variables.str_dateFormat,
f("#"+e).val()),f("#"+e).datepicker("option","minDate",d1),d2&&d1>d2&&(d2.setTime(d1.getTime()+432E6),f("#"+e).val(f.datepicker.formatDate(TG_Searchboxes_Variables.str_dateFormat,d2))))}})});if("object"==typeof d&&0<d.length){if(1==d.length){var c=d.get(0).id;f("#"+c).change(function(){f("#"+e).attr("disabled",this.value.length?!0:!1)})}if(2==d.length){c=d.get(0).id;d=d.get(1).id;var b=f("#"+e).parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);f("#"+d).change(function(){this.checked&&
(f("#"+e).attr("disabled",!0),null==b||"160x600"!=b[1]&&"300x533"!=b[1]&&"dynamic"!=b[1]||n(f("#"+e).get(0)))});f("#"+c).change(function(){this.checked&&(f("#"+e).attr("disabled",!1),null==b||"160x600"!=b[1]&&"300x533"!=b[1]&&"dynamic"!=b[1]||n(f("#"+e).get(0)))})}}}function B(a){a=f(a).filter(":not(.tg_searchbox_initialized)");a.addClass("tg_searchbox_initialized");if(0==a.length)return!1;a.find(".tgsb_addAS").each(function(){f(this).focus(y).blur(z);new AS(this.id,G)});a.find(".tgsb_addASH").each(function(){f(this).focus(y).blur(z);
new AS(this.id,H)});a.find("ul.tg_tabs li span").click(function(){selectedTab=f(this).attr("class").match(/^[a-z]+/);var a=f(this).parents("div.tg_searchbox:eq(0)");a.find("ul.tg_tabs li span").removeClass("sel");a.find("ul.tg_tabs li span."+selectedTab).addClass("sel");a.find("div.tg_container form").removeClass("sel");a.find("div.tg_container form."+selectedTab).addClass("sel");var d=a.find("div.tg_container form.sel"),c=d.find("input.tgsb_submit_button");F(selectedTab,d,function(){var a=d.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);
"160x600"!=a[1]&&"300x533"!=a[1]&&"dynamic"!=a[1]||n(c.get(0),!1,!1)})});a.find("form").each(function(){var a=f(this);a.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);var d=a.find("input.tgsb_submit_button");a.hasClass("sel")&&(selectedTab=a.attr("class").match(/^[a-z]+/),F(selectedTab,a,function(){var b=a.parents(".tg_searchbox").attr("class").match(/m(160x600|300x250|300x533|728x90|dynamic)/);"160x600"!=b[1]&&"300x533"!=b[1]&&"dynamic"!=b[1]||n(d.get(0),
!1,!1)}));var c=a.find("select[name=class]");c.length&&c.change(function(){n(this)});var b=a.find(".tgsb_addDP");if(1<b.length){var c=b.get(0).id,b=b.get(1).id,g=!1,g=a.hasClass("flights")?a.find("input[name=oneway], select[name=oneway]"):!1;L(c,b,g)}a.submit(function(){if(d.hasClass("submited"))return!1;d.addClass("submited");n(d.get(0),!0,!0);return!1})})}var E,G,H,l={},p,x;TGSB=new function(){this.queryCodes={flights:0,hotels:0,cars:0,packages:0,cruises:0};this.set=function(a,e){this.queryCodes[a]=
e;return!0};this.replacePlaceholder=A};f(function(){E={"160x600":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"300x250":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"300x533":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderCircle+'" width="100" height="100" alt="loading..." />',"728x90":'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />',
dynamic:'<img src="'+TG_Searchboxes_Variables.str_ajaxLoaderBert+'" width="128" height="15" alt="loading..." />'};G={delay:175,timeout:5E3,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",json:!0,frameForIE:!0,ajaxParams:{action:"",json:!0,lng:"def",dsgn:"flg",addtag:"em",citytype:"airports",domainPrefix:!0},autoSelect:!0,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[a-z]+[^>]*>/gi,"").replace(/(.*),(.*)\((.*)\)/,"$1 ($3)")},
callback:function(a,d){null==f(d.fld).parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/)&&n(d.fld)},errorHandler:function(a){f(a.fld).addClass("err").focus(u)}};H={delay:175,timeout:5E3,script:TG_Searchboxes_Variables.str_ASAjaxURL,loadingClass:"tgsb_as_load",className:"tgsb_as tgsb_asMargin",json:!0,frameForIE:!0,ajaxParams:{action:"",json:!0,lng:"def",dsgn:"flg",addtag:"em",citytype:"cities",domainPrefix:!0},autoSelect:!0,offsety:0,format:function(a){return a.innerHTML.replace(/<\/?[^>]+>/gi,
"").replace(/(.*),(.*) \((.*)\)/,"$1,$2")},callback:function(a,d){var c=f(d.fld);c.parents("div.tg_searchbox").find(".tgsb_addDest").val(a.id);null==c.parents(".tg_searchbox").attr("class").match(/(300x250|728x90)/)&&n(d.fld)}};B(".tg_searchbox");if("undefined"!=typeof TGSB_placeholders&&0<TGSB_placeholders.length)for(var a=0;a<TGSB_placeholders.length;a++)A(TGSB_placeholders[a].placeholder,TGSB_placeholders[a].html);I()})})(tgsb_myjquery);
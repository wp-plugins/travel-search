var tgsb_selBoxParam=!1,tgsb_images={"160x600":{url:TG_Searchboxes_Editor_Button.str_tgsb160x600,width:160,height:600,alignment:"alignnone"},"300x250":{url:TG_Searchboxes_Editor_Button.str_tgsb300x250,width:300,height:250,alignment:"alignnone"},"300x533":{url:TG_Searchboxes_Editor_Button.str_tgsb300x533,width:300,height:533,alignment:"alignnone"},"728x90":{url:TG_Searchboxes_Editor_Button.str_tgsb728x90,width:728,height:90,alignment:"alignnone"},dynamic:{url:TG_Searchboxes_Editor_Button.str_tgsbdynamic,
width:628,height:250,alignment:"alignnone"}};function tgsbFromAir(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbFromAir"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.from_air||(b='"from_air":"'+c.value+'"')});return b}
function tgsbToAir(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbToAir"!=c.name||0!=jQuery(c.obj).parents("form.hotels").length||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.to_air||(b='"to_air":"'+c.value+'"')});return b}
function tgsbHotelCity(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){!b&&"tgsbToAir"==c.name&&0<jQuery(c.obj).parents("form.hotels").length&&c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.hotel_city&&(b='"hotel_city":"'+c.value+'"')});console.log(b);return b}
function tgsbDepartureDate(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbDepartureDate"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date||(b='"departure_date":"'+c.value+'"')});return b}
function tgsbReturnDate(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbReturnDate"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.return_date||(b='"return_date":"'+c.value+'"')});return b}function tgsbAdults(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbAdults"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.adults||(b='"adults":"'+c.value+'"')});return b}
function tgsbKids(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbKids"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.kids||(b='"kids":"'+c.value+'"')});return b}function tgsbSeniors(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbSeniors"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.seniors||(b='"seniors":"'+c.value+'"')});return b}
function tgsbRooms(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"tgsbRooms"!=c.name||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings.rooms||(b='"rooms":"'+c.value+'"')});return b}function tgsbRTOW(a){if("undefined"==typeof a||0==a.length)return"";var b="";jQuery.each(a,function(a,c){b||"oneway"!=c.name||(c.value="on"==c.value?!0:!1,c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow&&(b='"rtow":"'+c.value+'"'))});return b}
function tgsbCruises(a){var b="";jQuery.each(a,function(a,c){!c.value||c.value==TG_Searchboxes_Variables.tgsbDefaultSettings[c.name]||"cruiseline"!=c.name&&"length_of_stay"!=c.name&&"destination"!=c.name&&"month_year"!=c.name||(b+='"'+c.name+'":"'+c.value+'",')});return b}function setAlignment(){var a="alignnone",b=jQuery("#TB_ajaxContent").find("input[name=img_align]");for(i in b)if(1==b[i].checked){a=b[i].value;break}return a}
var tgsb_popupInitOpt={init:function(a,b){var f=this;f.url=b;f._createButtons();a.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(f)});a.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:b+"/../images/tg20x20.gif"});a.onNodeChange.add(function(a,b,f){b.setActive("TGSearchboxes","IMG"==f.nodeName)});a.onMouseDown.add(function(a,b){if(b.target&&"IMG"==b.target.nodeName&&a.dom.hasClass(b.target,"TGSearchboxes")||
b.target&&b.target.firstChild&&"IMG"==b.target.firstChild.nodeName&&a.dom.hasClass(b.target.firstChild,"TGSearchboxes")){tgsb_selBoxParam=f.getAttr(b.target.title,"options");try{tgsb_selBoxParam=eval("("+tgsb_selBoxParam+")")}catch(h){tgsb_selBoxParam={size:"300x250",selectedTab:"flights"}}a.plugins.wordpress._showButtons(b.target,"wp_gallerybtns")}else tgsb_selBoxParam=!1});a.onBeforeSetContent.add(function(a,b){b.content=f._do_tg_searchboxes(b.content)});a.onPostProcess.add(function(a,b){b.get&&
(b.content=f._get_tg_searchboxes(b.content),"undefined"!=typeof tgsb_selBoxParam&&tgsb_selBoxParam&&(tgsb_selBoxParam=!1))})},getAttr:function(a,b){var f=(new RegExp(b+'="([^"]+)"',"g")).exec(a);return f?tinymce.DOM.decode(f[1]):(f=(new RegExp(b+"='([^']+)'","g")).exec(a))?tinymce.DOM.decode(f[1]):""},_get_tg_searchboxes:function(a){return a.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(a,f){return-1!=tgsb_popupInitOpt.getAttr(f,"class").indexOf("TGSearchboxes")?"<p>["+tinymce.trim(tgsb_popupInitOpt.getAttr(f,
"title"))+"]</p>":a})},_do_tg_searchboxes:function(a){return a.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,f){var c=tgsb_popupInitOpt.getAttr(a,"options"),g="300x250",h="",d=300,e=250;if(c.length){try{c=eval("("+c+")")}catch(k){c=""}"undefined"!=typeof c.size&&(g=c.size)}h=tgsb_images[g].url;d=tgsb_images[g].width;e=tgsb_images[g].height;tgsbImageAlign="undefined"==typeof c.alignment?tgsb_images[g].alignment:c.alignment;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem '+
tgsbImageAlign+'" style="background-image:url('+h+");background-repeat:no-repeat;width:"+d+"px;height:"+e+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(f)+'"/>'})},_createButtons:function(){var a=tinymce.DOM,b;a.remove("wp_gallerybtns");a.add(document.body,"div",{id:"wp_gallerybtns",style:"display:none;"});b=a.add("wp_gallerybtns","img",{src:this.url+"/img/edit.png",id:"wp_editgallery",width:"24",height:"24",title:"Edit Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(b,
"mousedown",function(a){a=tinyMCE.activeEditor;var b=a.selection.getNode();"IMG"==b.nodeName&&a.dom.hasClass(b,"TGSearchboxes")&&(a.windowManager.bookmark=a.selection.getBookmark("simple"),a.execCommand("mceTGSearchboxesInsert"))});a=a.add("wp_gallerybtns","img",{src:this.url+"/img/delete.png",id:"wp_delgallery",width:"24",height:"24",title:"Delete Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(a,"mousedown",function(a){a=tinyMCE.activeEditor;var b=a.selection.getNode();
if("IMG"==b.nodeName&&a.dom.hasClass(b,"TGSearchboxes"))return a.dom.remove(b),a.execCommand("mceRepaint"),!1})},createControl:function(a,b){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};
function tg_searchboxes_tinymce_button_click(a){var b=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig,"&");tb_show("Travelgrove Searchboxes",b,!1);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(b){b=jQuery(b.target);if(b.is("a.send_searchbox_to_editor")||b.is("input.send_searchbox_to_editor")){b=jQuery("ul.measuresChooser li a.current").text();b=0==b.length?"300x250":b;var c=jQuery(".sb"+b+" .tg_searchbox .tg_container").find("form.sel").attr("class").match(/^(flights|hotels|cars|packages|cruises)/),
g=[];jQuery(".sb"+b+" .tg_searchbox .tg_container form").find("input, select, textarea").each(function(){("radio"!=this.type&&"checkbox"!=this.type||this.checked)&&g.push({name:this.name,value:this.value,obj:this})});var h=jQuery("#travelSearchUseJavaScript").attr("checked"),d="",e=tgsbFromAir(g),d=d+(e.length?e+",":""),e=tgsbToAir(g),d=d+(e.length?e+",":""),e=tgsbHotelCity(g),d=d+(e.length?e+",":""),e=tgsbDepartureDate(g),d=d+(e.length?e+",":""),e=tgsbReturnDate(g),d=d+(e.length?e+",":""),e=tgsbAdults(g),
d=d+(e.length?e+",":""),e=tgsbKids(g),d=d+(e.length?e+",":""),e=tgsbSeniors(g),d=d+(e.length?e+",":""),e=tgsbRooms(g),d=d+(e.length?e+",":""),e=tgsbRTOW(g),d=d+(e.length?e+",":""),d=d+tgsbCruises(g),d=d+(h?'"usejavascript":"on",':"")+("300x250"==b?"":'"size":"'+b+'",'),d=d+(null==c?'"selectedTab":"flights",':"flights"==c[1]?"":'"selectedTab":"'+c[1]+'",');alignment=setAlignment();d+="alignnone"==alignment?"":'"alignment":"'+alignment+'"';d.match(/\,$/)&&(d=d.replace(/\,$/,""));b="[tg_searchboxes"+
(d.length?" options='{"+d+"}']":"]");b=a._do_tg_searchboxes(b);tinyMCE.execCommand("mceInsertContent",0,b);"undefined"!=typeof tgsb_selBoxParam&&tgsb_selBoxParam&&(tgsb_selBoxParam=!1);tb_remove()}return!1});return!1}jQuery(document).ready(function(a){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)});
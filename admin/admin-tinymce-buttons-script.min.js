var tgsb_selBoxParam=!1,tgsb_images={"160x600":{url:TG_Searchboxes_Editor_Button.str_tgsb160x600,width:160,height:600,alignment:"alignnone"},"300x250":{url:TG_Searchboxes_Editor_Button.str_tgsb300x250,width:300,height:250,alignment:"alignnone"},"300x533":{url:TG_Searchboxes_Editor_Button.str_tgsb300x533,width:300,height:533,alignment:"alignnone"},"728x90":{url:TG_Searchboxes_Editor_Button.str_tgsb728x90,width:728,height:90,alignment:"alignnone"},dynamic:{url:TG_Searchboxes_Editor_Button.str_tgsbdynamic,
width:628,height:250,alignment:"alignnone"}};function tgsbFromAir(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbFromAir"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.from_air&&(returnValue='"from_air":"'+b.value+'"')});return returnValue}
function tgsbToAir(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbToAir"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.to_air&&(returnValue='"to_air":"'+b.value+'"')});return returnValue}
function tgsbDepartureDate(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbDepartureDate"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date&&(returnValue='"departure_date":"'+b.value+'"')});return returnValue}
function tgsbReturnDate(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbReturnDate"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.return_date&&(returnValue='"return_date":"'+b.value+'"')});return returnValue}
function tgsbAdults(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbAdults"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.adults&&(returnValue='"adults":"'+b.value+'"')});return returnValue}
function tgsbKids(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbKids"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.kids&&(returnValue='"kids":"'+b.value+'"')});return returnValue}
function tgsbSeniors(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbSeniors"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.seniors&&(returnValue='"seniors":"'+b.value+'"')});return returnValue}
function tgsbRooms(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"tgsbRooms"==b.name&&b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rooms&&(returnValue='"rooms":"'+b.value+'"')});return returnValue}
function tgsbRTOW(a){if("undefined"==typeof a||0==a.length)return"";returnValue="";jQuery.each(a,function(a,b){"oneway"==b.name&&(b.value="on"==b.value?!0:!1,b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow&&(returnValue='"rtow":"'+b.value+'"'))});return returnValue}
function tgsbCruises(a){var d="";jQuery.each(a,function(b,a){!a.value||a.value==TG_Searchboxes_Variables.tgsbDefaultSettings[a.name]||"cruiseline"!=a.name&&"length_of_stay"!=a.name&&"destination"!=a.name&&"month_year"!=a.name||(d+='"'+a.name+'":"'+a.value+'",')});return d}function setAlignment(){var a="alignnone",d=jQuery("#TB_ajaxContent").find("input[name=img_align]");for(i in d)if(1==d[i].checked){a=d[i].value;break}return a}
var tgsb_popupInitOpt={init:function(a,d){var b=this;b.url=d;b._createButtons();a.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(b)});a.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:d+"/../images/tg20x20.gif"});a.onNodeChange.add(function(b,a,d){a.setActive("TGSearchboxes","IMG"==d.nodeName)});a.onMouseDown.add(function(a,e){if(e.target&&"IMG"==e.target.nodeName&&a.dom.hasClass(e.target,"TGSearchboxes")||
e.target&&e.target.firstChild&&"IMG"==e.target.firstChild.nodeName&&a.dom.hasClass(e.target.firstChild,"TGSearchboxes")){tgsb_selBoxParam=b.getAttr(e.target.title,"options");try{tgsb_selBoxParam=eval("("+tgsb_selBoxParam+")")}catch(d){tgsb_selBoxParam={size:"300x250",selectedTab:"flights"}}a.plugins.wordpress._showButtons(e.target,"wp_gallerybtns")}else tgsb_selBoxParam=!1});a.onBeforeSetContent.add(function(a,e){e.content=b._do_tg_searchboxes(e.content)});a.onPostProcess.add(function(a,e){e.get&&
(e.content=b._get_tg_searchboxes(e.content),"undefined"!=typeof tgsb_selBoxParam&&tgsb_selBoxParam&&(tgsb_selBoxParam=!1))})},getAttr:function(a,d){var b=(new RegExp(d+'="([^"]+)"',"g")).exec(a);return b?tinymce.DOM.decode(b[1]):(b=(new RegExp(d+"='([^']+)'","g")).exec(a))?tinymce.DOM.decode(b[1]):""},_get_tg_searchboxes:function(a){return a.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(a,b){return-1!=tgsb_popupInitOpt.getAttr(b,"class").indexOf("TGSearchboxes")?"<p>["+tinymce.trim(tgsb_popupInitOpt.getAttr(b,
"title"))+"]</p>":a})},_do_tg_searchboxes:function(a){return a.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,b){var f=tgsb_popupInitOpt.getAttr(a,"options"),e="300x250",g="",c=300,h=250;if(f.length){try{f=eval("("+f+")")}catch(k){f=""}"undefined"!=typeof f.size&&(e=f.size)}g=tgsb_images[e].url;c=tgsb_images[e].width;h=tgsb_images[e].height;tgsbImageAlign="undefined"==typeof f.alignment?tgsb_images[e].alignment:f.alignment;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem '+
tgsbImageAlign+'" style="background-image:url('+g+");background-repeat:no-repeat;width:"+c+"px;height:"+h+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(b)+'"/>'})},_createButtons:function(){var a=tinymce.DOM,d;a.remove("wp_gallerybtns");a.add(document.body,"div",{id:"wp_gallerybtns",style:"display:none;"});d=a.add("wp_gallerybtns","img",{src:this.url+"/img/edit.png",id:"wp_editgallery",width:"24",height:"24",title:"Edit Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(d,
"mousedown",function(a){a=tinyMCE.activeEditor;var d=a.selection.getNode();"IMG"==d.nodeName&&a.dom.hasClass(d,"TGSearchboxes")&&(a.windowManager.bookmark=a.selection.getBookmark("simple"),a.execCommand("mceTGSearchboxesInsert"))});a=a.add("wp_gallerybtns","img",{src:this.url+"/img/delete.png",id:"wp_delgallery",width:"24",height:"24",title:"Delete Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(a,"mousedown",function(a){a=tinyMCE.activeEditor;var d=a.selection.getNode();
if("IMG"==d.nodeName&&a.dom.hasClass(d,"TGSearchboxes"))return a.dom.remove(d),a.execCommand("mceRepaint"),!1})},createControl:function(a,d){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};
function tg_searchboxes_tinymce_button_click(a){var d=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig,"&");tb_show("Travelgrove Searchboxes",d,!1);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(b){b=jQuery(b.target);if(b.is("a.send_searchbox_to_editor")||b.is("input.send_searchbox_to_editor")){b=jQuery("ul.measuresChooser li a.current").text();b=0==b.length?"300x250":b;var d=jQuery(".sb"+b+" .tg_searchbox .tg_container").find("form.sel").attr("class").match(/^(flights|hotels|cars|packages|cruises)/),
e=jQuery(".sb"+b+" .tg_searchbox .tg_container form").serializeArray(),g=jQuery("#travelSearchUseJavaScript").attr("checked"),c="";tgsb_fromAir=tgsbFromAir(e);c+=tgsb_fromAir.length?tgsb_fromAir+",":tgsb_fromAir;tgsb_toAir=tgsbToAir(e);c+=tgsb_toAir.length?tgsb_toAir+",":tgsb_toAir;tgsb_departureDate=tgsbDepartureDate(e);c+=tgsb_departureDate.length?tgsb_departureDate+",":tgsb_departureDate;tgsb_returnDate=tgsbReturnDate(e);c+=tgsb_returnDate.length?tgsb_returnDate+",":tgsb_returnDate;tgsb_adults=
tgsbAdults(e);c+=tgsb_adults.length?tgsb_adults+",":tgsb_adults;tgsb_kids=tgsbKids(e);c+=tgsb_kids.length?tgsb_kids+",":tgsb_kids;tgsb_seniors=tgsbSeniors(e);c+=tgsb_seniors.length?tgsb_seniors+",":tgsb_seniors;tgsb_rooms=tgsbRooms(e);c+=tgsb_rooms.length?tgsb_rooms+",":tgsb_rooms;tgsb_rtow=tgsbRTOW(e);c+=tgsb_rtow.length?tgsb_rtow+",":tgsb_rtow;c+=tgsbCruises(e);c=c+(g?'"usejavascript":"on",':"")+("300x250"==b?"":'"size":"'+b+'",');c+=null==d?'"selectedTab":"flights",':"flights"==d[1]?"":'"selectedTab":"'+
d[1]+'",';alignment=setAlignment();c+="alignnone"==alignment?"":'"alignment":"'+alignment+'"';c.match(/\,$/)&&(c=c.replace(/\,$/,""));b="[tg_searchboxes"+(c.length?" options='{"+c+"}']":"]");b=a._do_tg_searchboxes(b);tinyMCE.execCommand("mceInsertContent",0,b);"undefined"!=typeof tgsb_selBoxParam&&tgsb_selBoxParam&&(tgsb_selBoxParam=!1);tb_remove()}return!1});return!1}
jQuery(document).ready(function(a){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)});
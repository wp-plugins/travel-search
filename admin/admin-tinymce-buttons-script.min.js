var tgsb_selBoxParam=false;var tgsb_images={'160x600':{'url':TG_Searchboxes_Editor_Button.str_tgsb160x600,'width':160,'height':600},'300x250':{'url':TG_Searchboxes_Editor_Button.str_tgsb300x250,'width':300,'height':250},'300x533':{'url':TG_Searchboxes_Editor_Button.str_tgsb300x533,'width':300,'height':533},'728x90':{'url':TG_Searchboxes_Editor_Button.str_tgsb728x90,'width':728,'height':90},'dynamic':{'url':TG_Searchboxes_Editor_Button.str_tgsbdynamic,'width':628,'height':250}};function tgsbFromAir(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbFromAir'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.from_air){returnValue='"from_air":"'+field.value+'"';return}}});return returnValue};function tgsbToAir(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbToAir'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.to_air){returnValue='"to_air":"'+field.value+'"';return}}});return returnValue};function tgsbDepartureDate(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbDepartureDate'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date){returnValue='"departure_date":"'+field.value+'"';return}}});return returnValue};function tgsbReturnDate(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbReturnDate'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.return_date){returnValue='"return_date":"'+field.value+'"';return}}});return returnValue};function tgsbAdults(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbAdults'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.adults){returnValue='"adults":"'+field.value+'"';return}}});return returnValue};function tgsbKids(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbKids'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.kids){returnValue='"kids":"'+field.value+'"';return}}});return returnValue};function tgsbSeniors(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbSeniors'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.seniors){returnValue='"seniors":"'+field.value+'"';return}}});return returnValue};function tgsbRooms(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='tgsbRooms'){if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rooms){returnValue='"rooms":"'+field.value+'"';return}}});return returnValue};function tgsbRTOW(serializedFieldsArray){if(typeof(serializedFieldsArray)=='undefined'||serializedFieldsArray.length==0)return'';returnValue='';jQuery.each(serializedFieldsArray,function(i,field){if(field.name=='oneway'){field.value=(field.value=='on')?true:false;if(field.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow){returnValue='"rtow":"'+field.value+'"';return}}});return returnValue};var tgsb_popupInitOpt={init:function(ed,url){var t=this;t.url=url;t._createButtons();ed.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(t)});ed.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:url+"/../images/tg20x20.gif"});ed.onNodeChange.add(function(ed,cm,n){cm.setActive("TGSearchboxes",n.nodeName=="IMG")});ed.onMouseDown.add(function(ed,e){if(e.target.nodeName=='IMG'&&ed.dom.hasClass(e.target,'TGSearchboxes')){tgsb_selBoxParam=t.getAttr(e.target.title,'options');try{tgsb_selBoxParam=eval('('+tgsb_selBoxParam+')')}catch(tgsb_err){tgsb_selBoxParam={"size":"300x250","selectedTab":"flights"}};ed.plugins.wordpress._showButtons(e.target,'wp_gallerybtns')}else{tgsb_selBoxParam=false}});ed.onBeforeSetContent.add(function(ed,o){o.content=t._do_tg_searchboxes(o.content)});ed.onPostProcess.add(function(ed,o){if(o.get){o.content=t._get_tg_searchboxes(o.content);if(typeof(tgsb_selBoxParam)!='undefined'&&tgsb_selBoxParam)tgsb_selBoxParam=false}})},getAttr:function(s,n){var res=new RegExp(n+'=\"([^\"]+)\"','g').exec(s);if(res)return tinymce.DOM.decode(res[1]);res=new RegExp(n+"=\'([^\']+)\'",'g').exec(s);if(res)return tinymce.DOM.decode(res[1]);return''},_get_tg_searchboxes:function(co){return co.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(a,im){var cls=tgsb_popupInitOpt.getAttr(im,'class');if(cls.indexOf('TGSearchboxes')!=-1){return'<p>['+tinymce.trim(tgsb_popupInitOpt.getAttr(im,'title'))+']</p>'};return a})},_do_tg_searchboxes:function(co){return co.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,b){var options=tgsb_popupInitOpt.getAttr(a,'options');var tgSearchboxSize='300x250';var tgsbImageUrl='';var tgsbImageWidth=300;var tgsbImageHeight=250;if(options.length){try{options=eval('('+options+')')}catch(tgsb_err){options=''};if(typeof(options.size)!='undefined'){tgSearchboxSize=options.size}};tgsbImageUrl=tgsb_images[tgSearchboxSize].url;tgsbImageWidth=tgsb_images[tgSearchboxSize].width;tgsbImageHeight=tgsb_images[tgSearchboxSize].height;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem" style="background-image:url('+tgsbImageUrl+');background-repeat:no-repeat;width:'+tgsbImageWidth+'px;height:'+tgsbImageHeight+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(b)+'"/>'})},_createButtons:function(){var t=this,ed=tinyMCE.activeEditor,DOM=tinymce.DOM,editButton,dellButton;DOM.remove('wp_gallerybtns');DOM.add(document.body,'div',{id:'wp_gallerybtns',style:'display:none;'});editButton=DOM.add('wp_gallerybtns','img',{src:t.url+'/img/edit.png',id:'wp_editgallery',width:'24',height:'24',title:'Edit Searchbox'});tinymce.dom.Event.add(editButton,'mousedown',function(e){var ed=tinyMCE.activeEditor;ed.windowManager.bookmark=ed.selection.getBookmark('simple');ed.execCommand("mceTGSearchboxesInsert")});dellButton=DOM.add('wp_gallerybtns','img',{src:t.url+'/img/delete.png',id:'wp_delgallery',width:'24',height:'24',title:'Delete Searchbox'});tinymce.dom.Event.add(dellButton,'mousedown',function(e){var ed=tinyMCE.activeEditor,el=ed.selection.getNode();if(el.nodeName=='IMG'&&ed.dom.hasClass(el,'TGSearchboxes')){ed.dom.remove(el);ed.execCommand('mceRepaint');return false}})},createControl:function(n,cm){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};function tg_searchboxes_tinymce_button_click(tinyMCE_obj){var title="Travelgrove Searchboxes";var url=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig, '&');tb_show(title,url,false);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(event){var $target=jQuery(event.target);if($target.is('a.send_searchbox_to_editor')||$target.is('input.send_searchbox_to_editor')){var tgSearchboxMeasures=jQuery('ul.measuresChooser li a.current').text();tgSearchboxMeasures=(tgSearchboxMeasures.length==0)?'300x250':tgSearchboxMeasures;var selectedTab=jQuery('.sb'+tgSearchboxMeasures+' .tg_searchbox .tg_container').find('form.sel').attr('class').match(/^(flights|hotels|cars|packages)/);var fields=jQuery('.sb'+tgSearchboxMeasures+' .tg_searchbox .tg_container form').serializeArray();var optionsString='';tgsb_fromAir=tgsbFromAir(fields);optionsString+=(tgsb_fromAir.length)?tgsb_fromAir+',':tgsb_fromAir;tgsb_toAir=tgsbToAir(fields);optionsString+=(tgsb_toAir.length)?tgsb_toAir+',':tgsb_toAir;tgsb_departureDate=tgsbDepartureDate(fields);optionsString+=(tgsb_departureDate.length)?tgsb_departureDate+',':tgsb_departureDate;tgsb_returnDate=tgsbReturnDate(fields);optionsString+=(tgsb_returnDate.length)?tgsb_returnDate+',':tgsb_returnDate;tgsb_adults=tgsbAdults(fields);optionsString+=(tgsb_adults.length)?tgsb_adults+',':tgsb_adults;tgsb_kids=tgsbKids(fields);optionsString+=(tgsb_kids.length)?tgsb_kids+',':tgsb_kids;tgsb_seniors=tgsbSeniors(fields);optionsString+=(tgsb_seniors.length)?tgsb_seniors+',':tgsb_seniors;tgsb_rooms=tgsbRooms(fields);optionsString+=(tgsb_rooms.length)?tgsb_rooms+',':tgsb_rooms;tgsb_rtow=tgsbRTOW(fields);optionsString+=(tgsb_rtow.length)?tgsb_rtow+',':tgsb_rtow;optionsString+=(tgSearchboxMeasures=='300x250')?'':'"size":"'+tgSearchboxMeasures+'",';optionsString+=(selectedTab==null)?'"selectedTab":"flights"':((selectedTab[1]=='flights')?'':'"selectedTab":"'+selectedTab[1]+'"');if(optionsString.match(/\,$/)){optionsString = optionsString.replace(/\,$/, '');};var tgSearchboxesShortcode='[tg_searchboxes'+(optionsString.length?' options=\'{'+optionsString+'}\']':']');tgSearchboxesShortcode=tinyMCE_obj._do_tg_searchboxes(tgSearchboxesShortcode);tinyMCE.execCommand("mceInsertContent",0,tgSearchboxesShortcode);if(typeof(tgsb_selBoxParam)!='undefined'&&tgsb_selBoxParam){tgsb_selBoxParam=false};tb_remove();return false};return false});return false};jQuery(document).ready(function(jQuery){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)});
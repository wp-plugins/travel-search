var tgsb_selBoxParam=false;var tgsb_images={"160x600":{url:TG_Searchboxes_Editor_Button.str_tgsb160x600,width:160,height:600,alignment:"alignnone"},"300x250":{url:TG_Searchboxes_Editor_Button.str_tgsb300x250,width:300,height:250,alignment:"alignnone"},"300x533":{url:TG_Searchboxes_Editor_Button.str_tgsb300x533,width:300,height:533,alignment:"alignnone"},"728x90":{url:TG_Searchboxes_Editor_Button.str_tgsb728x90,width:728,height:90,alignment:"alignnone"},dynamic:{url:TG_Searchboxes_Editor_Button.str_tgsbdynamic,width:628,height:250,alignment:"alignnone"}};function tgsbFromAir(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbFromAir"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.from_air){returnValue='"from_air":"'+b.value+'"';return}}});return returnValue}function tgsbToAir(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbToAir"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.to_air){returnValue='"to_air":"'+b.value+'"';return}}});return returnValue}function tgsbDepartureDate(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbDepartureDate"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date){returnValue='"departure_date":"'+b.value+'"';return}}});return returnValue}function tgsbReturnDate(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbReturnDate"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.return_date){returnValue='"return_date":"'+b.value+'"';return}}});return returnValue}function tgsbAdults(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbAdults"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.adults){returnValue='"adults":"'+b.value+'"';return}}});return returnValue}function tgsbKids(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbKids"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.kids){returnValue='"kids":"'+b.value+'"';return}}});return returnValue}function tgsbSeniors(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbSeniors"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.seniors){returnValue='"seniors":"'+b.value+'"';return}}});return returnValue}function tgsbRooms(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="tgsbRooms"){if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rooms){returnValue='"rooms":"'+b.value+'"';return}}});return returnValue}function tgsbRTOW(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(c,b){if(b.name=="oneway"){b.value=(b.value=="on")?true:false;if(b.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow){returnValue='"rtow":"'+b.value+'"';return}}});return returnValue}function setAlignment(){var a="alignnone";var b=jQuery("#TB_ajaxContent").find("input[name=img_align]");for(i in b){if(b[i].checked==true){a=b[i].value;break}}return a}var tgsb_popupInitOpt={init:function(ed,url){var t=this;t.url=url;t._createButtons();ed.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(t)});ed.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:url+"/../images/tg20x20.gif"});ed.onNodeChange.add(function(ed,cm,n){cm.setActive("TGSearchboxes",n.nodeName=="IMG")});ed.onMouseDown.add(function(ed,e){if((e.target&&e.target.nodeName=="IMG"&&ed.dom.hasClass(e.target,"TGSearchboxes"))||(e.target&&e.target.firstChild&&e.target.firstChild.nodeName=="IMG"&&ed.dom.hasClass(e.target.firstChild,"TGSearchboxes"))){tgsb_selBoxParam=t.getAttr(e.target.title,"options");try{tgsb_selBoxParam=eval("("+tgsb_selBoxParam+")")}catch(tgsb_err){tgsb_selBoxParam={size:"300x250",selectedTab:"flights"}}ed.plugins.wordpress._showButtons(e.target,"wp_gallerybtns")}else{tgsb_selBoxParam=false}});ed.onBeforeSetContent.add(function(ed,o){o.content=t._do_tg_searchboxes(o.content)});ed.onPostProcess.add(function(ed,o){if(o.get){o.content=t._get_tg_searchboxes(o.content);if(typeof(tgsb_selBoxParam)!="undefined"&&tgsb_selBoxParam){tgsb_selBoxParam=false}}})},getAttr:function(a,c){var b=new RegExp(c+'="([^"]+)"',"g").exec(a);if(b){return tinymce.DOM.decode(b[1])}b=new RegExp(c+"='([^']+)'","g").exec(a);if(b){return tinymce.DOM.decode(b[1])}return""},_get_tg_searchboxes:function(a){return a.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(c,b){var d=tgsb_popupInitOpt.getAttr(b,"class");if(d.indexOf("TGSearchboxes")!=-1){return"<p>["+tinymce.trim(tgsb_popupInitOpt.getAttr(b,"title"))+"]</p>"}return c})},_do_tg_searchboxes:function(co){return co.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,b){var options=tgsb_popupInitOpt.getAttr(a,"options");var tgSearchboxSize="300x250";var tgsbImageUrl="";var tgsbImageWidth=300;var tgsbImageHeight=250;if(options.length){try{options=eval("("+options+")")}catch(tgsb_err){options=""}if(typeof(options.size)!="undefined"){tgSearchboxSize=options.size}}tgsbImageUrl=tgsb_images[tgSearchboxSize].url;tgsbImageWidth=tgsb_images[tgSearchboxSize].width;tgsbImageHeight=tgsb_images[tgSearchboxSize].height;tgsbImageAlign=(typeof(options.alignment)=="undefined")?tgsb_images[tgSearchboxSize].alignment:options.alignment;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem '+tgsbImageAlign+'" style="background-image:url('+tgsbImageUrl+");background-repeat:no-repeat;width:"+tgsbImageWidth+"px;height:"+tgsbImageHeight+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(b)+'"/>'})},_createButtons:function(){var c=this,e=tinyMCE.activeEditor,b=tinymce.DOM,d,a;b.remove("wp_gallerybtns");b.add(document.body,"div",{id:"wp_gallerybtns",style:"display:none;"});d=b.add("wp_gallerybtns","img",{src:c.url+"/img/edit.png",id:"wp_editgallery",width:"24",height:"24",title:"Edit Searchbox"});tinymce.dom.Event.add(d,"mousedown",function(f){var g=tinyMCE.activeEditor;g.windowManager.bookmark=g.selection.getBookmark("simple");g.execCommand("mceTGSearchboxesInsert")});a=b.add("wp_gallerybtns","img",{src:c.url+"/img/delete.png",id:"wp_delgallery",width:"24",height:"24",title:"Delete Searchbox"});tinymce.dom.Event.add(a,"mousedown",function(g){var h=tinyMCE.activeEditor,f=h.selection.getNode();if(f.nodeName=="IMG"&&h.dom.hasClass(f,"TGSearchboxes")){h.dom.remove(f);h.execCommand("mceRepaint");return false}})},createControl:function(a,b){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};function tg_searchboxes_tinymce_button_click(b){var a="Travelgrove Searchboxes";var c=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig,"&");tb_show(a,c,false);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(l){var d=jQuery(l.target);if(d.is("a.send_searchbox_to_editor")||d.is("input.send_searchbox_to_editor")){var j=jQuery("ul.measuresChooser li a.current").text();j=(j.length==0)?"300x250":j;var f=jQuery(".sb"+j+" .tg_searchbox .tg_container").find("form.sel").attr("class").match(/^(flights|hotels|cars|packages)/);var g=jQuery(".sb"+j+" .tg_searchbox .tg_container form").serializeArray();var k=jQuery("#travelSearchUseJavaScript").attr("checked");var e="";tgsb_fromAir=tgsbFromAir(g);e+=(tgsb_fromAir.length)?tgsb_fromAir+",":tgsb_fromAir;tgsb_toAir=tgsbToAir(g);e+=(tgsb_toAir.length)?tgsb_toAir+",":tgsb_toAir;tgsb_departureDate=tgsbDepartureDate(g);e+=(tgsb_departureDate.length)?tgsb_departureDate+",":tgsb_departureDate;tgsb_returnDate=tgsbReturnDate(g);e+=(tgsb_returnDate.length)?tgsb_returnDate+",":tgsb_returnDate;tgsb_adults=tgsbAdults(g);e+=(tgsb_adults.length)?tgsb_adults+",":tgsb_adults;tgsb_kids=tgsbKids(g);e+=(tgsb_kids.length)?tgsb_kids+",":tgsb_kids;tgsb_seniors=tgsbSeniors(g);e+=(tgsb_seniors.length)?tgsb_seniors+",":tgsb_seniors;tgsb_rooms=tgsbRooms(g);e+=(tgsb_rooms.length)?tgsb_rooms+",":tgsb_rooms;tgsb_rtow=tgsbRTOW(g);e+=(tgsb_rtow.length)?tgsb_rtow+",":tgsb_rtow;e+=k?'"usejavascript":"on",':"";e+=(j=="300x250")?"":'"size":"'+j+'",';e+=(f==null)?'"selectedTab":"flights",':((f[1]=="flights")?"":'"selectedTab":"'+f[1]+'",');alignment=setAlignment();e+=(alignment=="alignnone")?"":'"alignment":"'+alignment+'"';if(e.match(/\,$/)){e=e.replace(/\,$/,"")}var h="[tg_searchboxes"+(e.length?" options='{"+e+"}']":"]");h=b._do_tg_searchboxes(h);tinyMCE.execCommand("mceInsertContent",0,h);if(typeof(tgsb_selBoxParam)!="undefined"&&tgsb_selBoxParam){tgsb_selBoxParam=false}tb_remove();return false}return false});return false}jQuery(document).ready(function(a){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)});
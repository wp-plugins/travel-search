function tgsbFromAir(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbFromAir"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.from_air){returnValue='"from_air":"'+t.value+'"';return}}});return returnValue}function tgsbToAir(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbToAir"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.to_air){returnValue='"to_air":"'+t.value+'"';return}}});return returnValue}function tgsbDepartureDate(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbDepartureDate"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date){returnValue='"departure_date":"'+t.value+'"';return}}});return returnValue}function tgsbReturnDate(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbReturnDate"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.return_date){returnValue='"return_date":"'+t.value+'"';return}}});return returnValue}function tgsbAdults(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbAdults"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.adults){returnValue='"adults":"'+t.value+'"';return}}});return returnValue}function tgsbKids(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbKids"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.kids){returnValue='"kids":"'+t.value+'"';return}}});return returnValue}function tgsbSeniors(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbSeniors"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.seniors){returnValue='"seniors":"'+t.value+'"';return}}});return returnValue}function tgsbRooms(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="tgsbRooms"){if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rooms){returnValue='"rooms":"'+t.value+'"';return}}});return returnValue}function tgsbRTOW(e){if(typeof e=="undefined"||e.length==0)return"";returnValue="";jQuery.each(e,function(e,t){if(t.name=="oneway"){t.value=t.value=="on"?true:false;if(t.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow){returnValue='"rtow":"'+t.value+'"';return}}});return returnValue}function setAlignment(){var e="alignnone";var t=jQuery("#TB_ajaxContent").find("input[name=img_align]");for(i in t){if(t[i].checked==true){e=t[i].value;break}}return e}function tg_searchboxes_tinymce_button_click(e){var t="Travelgrove Searchboxes";var n=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig,"&");tb_show(t,n,false);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(t){var n=jQuery(t.target);if(n.is("a.send_searchbox_to_editor")||n.is("input.send_searchbox_to_editor")){var r=jQuery("ul.measuresChooser li a.current").text();r=r.length==0?"300x250":r;var i=jQuery(".sb"+r+" .tg_searchbox .tg_container").find("form.sel").attr("class").match(/^(flights|hotels|cars|packages)/);var s=jQuery(".sb"+r+" .tg_searchbox .tg_container form").serializeArray();var o=jQuery("#travelSearchUseJavaScript").attr("checked");var u="";tgsb_fromAir=tgsbFromAir(s);u+=tgsb_fromAir.length?tgsb_fromAir+",":tgsb_fromAir;tgsb_toAir=tgsbToAir(s);u+=tgsb_toAir.length?tgsb_toAir+",":tgsb_toAir;tgsb_departureDate=tgsbDepartureDate(s);u+=tgsb_departureDate.length?tgsb_departureDate+",":tgsb_departureDate;tgsb_returnDate=tgsbReturnDate(s);u+=tgsb_returnDate.length?tgsb_returnDate+",":tgsb_returnDate;tgsb_adults=tgsbAdults(s);u+=tgsb_adults.length?tgsb_adults+",":tgsb_adults;tgsb_kids=tgsbKids(s);u+=tgsb_kids.length?tgsb_kids+",":tgsb_kids;tgsb_seniors=tgsbSeniors(s);u+=tgsb_seniors.length?tgsb_seniors+",":tgsb_seniors;tgsb_rooms=tgsbRooms(s);u+=tgsb_rooms.length?tgsb_rooms+",":tgsb_rooms;tgsb_rtow=tgsbRTOW(s);u+=tgsb_rtow.length?tgsb_rtow+",":tgsb_rtow;u+=o?'"usejavascript":"on",':"";u+=r=="300x250"?"":'"size":"'+r+'",';u+=i==null?'"selectedTab":"flights",':i[1]=="flights"?"":'"selectedTab":"'+i[1]+'",';alignment=setAlignment();u+=alignment=="alignnone"?"":'"alignment":"'+alignment+'"';if(u.match(/\,$/)){u=u.replace(/\,$/,"")}var a="[tg_searchboxes"+(u.length?" options='{"+u+"}']":"]");a=e._do_tg_searchboxes(a);tinyMCE.execCommand("mceInsertContent",0,a);if(typeof tgsb_selBoxParam!="undefined"&&tgsb_selBoxParam){tgsb_selBoxParam=false}tb_remove();return false}return false});return false}var tgsb_selBoxParam=false;var tgsb_images={"160x600":{url:TG_Searchboxes_Editor_Button.str_tgsb160x600,width:160,height:600,alignment:"alignnone"},"300x250":{url:TG_Searchboxes_Editor_Button.str_tgsb300x250,width:300,height:250,alignment:"alignnone"},"300x533":{url:TG_Searchboxes_Editor_Button.str_tgsb300x533,width:300,height:533,alignment:"alignnone"},"728x90":{url:TG_Searchboxes_Editor_Button.str_tgsb728x90,width:728,height:90,alignment:"alignnone"},dynamic:{url:TG_Searchboxes_Editor_Button.str_tgsbdynamic,width:628,height:250,alignment:"alignnone"}};var tgsb_popupInitOpt={init:function(ed,url){var t=this;t.url=url;t._createButtons();ed.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(t)});ed.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:url+"/../images/tg20x20.gif"});ed.onNodeChange.add(function(e,t,n){t.setActive("TGSearchboxes",n.nodeName=="IMG")});ed.onMouseDown.add(function(ed,e){if(e.target&&e.target.nodeName=="IMG"&&ed.dom.hasClass(e.target,"TGSearchboxes")||e.target&&e.target.firstChild&&e.target.firstChild.nodeName=="IMG"&&ed.dom.hasClass(e.target.firstChild,"TGSearchboxes")){tgsb_selBoxParam=t.getAttr(e.target.title,"options");try{tgsb_selBoxParam=eval("("+tgsb_selBoxParam+")")}catch(tgsb_err){tgsb_selBoxParam={size:"300x250",selectedTab:"flights"}}ed.plugins.wordpress._showButtons(e.target,"wp_gallerybtns")}else{tgsb_selBoxParam=false}});ed.onBeforeSetContent.add(function(e,n){n.content=t._do_tg_searchboxes(n.content)});ed.onPostProcess.add(function(e,n){if(n.get){n.content=t._get_tg_searchboxes(n.content);if(typeof tgsb_selBoxParam!="undefined"&&tgsb_selBoxParam)tgsb_selBoxParam=false}})},getAttr:function(e,t){var n=(new RegExp(t+'="([^"]+)"',"g")).exec(e);if(n)return tinymce.DOM.decode(n[1]);n=(new RegExp(t+"='([^']+)'","g")).exec(e);if(n)return tinymce.DOM.decode(n[1]);return""},_get_tg_searchboxes:function(e){return e.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(e,t){var n=tgsb_popupInitOpt.getAttr(t,"class");if(n.indexOf("TGSearchboxes")!=-1){return"<p>["+tinymce.trim(tgsb_popupInitOpt.getAttr(t,"title"))+"]</p>"}return e})},_do_tg_searchboxes:function(co){return co.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,b){var options=tgsb_popupInitOpt.getAttr(a,"options");var tgSearchboxSize="300x250";var tgsbImageUrl="";var tgsbImageWidth=300;var tgsbImageHeight=250;if(options.length){try{options=eval("("+options+")")}catch(tgsb_err){options=""}if(typeof options.size!="undefined"){tgSearchboxSize=options.size}}tgsbImageUrl=tgsb_images[tgSearchboxSize].url;tgsbImageWidth=tgsb_images[tgSearchboxSize].width;tgsbImageHeight=tgsb_images[tgSearchboxSize].height;tgsbImageAlign=typeof options.alignment=="undefined"?tgsb_images[tgSearchboxSize].alignment:options.alignment;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem '+tgsbImageAlign+'" style="background-image:url('+tgsbImageUrl+");background-repeat:no-repeat;width:"+tgsbImageWidth+"px;height:"+tgsbImageHeight+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(b)+'"/>'})},_createButtons:function(){var e=this,t=tinyMCE.activeEditor,n=tinymce.DOM,r,i;n.remove("wp_gallerybtns");n.add(document.body,"div",{id:"wp_gallerybtns",style:"display:none;"});r=n.add("wp_gallerybtns","img",{src:e.url+"/img/edit.png",id:"wp_editgallery",width:"24",height:"24",title:"Edit Searchbox"});tinymce.dom.Event.add(r,"mousedown",function(e){var t=tinyMCE.activeEditor,n=t.selection.getNode();if(n.nodeName=="IMG"&&t.dom.hasClass(n,"TGSearchboxes")){t.windowManager.bookmark=t.selection.getBookmark("simple");t.execCommand("mceTGSearchboxesInsert")}});i=n.add("wp_gallerybtns","img",{src:e.url+"/img/delete.png",id:"wp_delgallery",width:"24",height:"24",title:"Delete Searchbox"});tinymce.dom.Event.add(i,"mousedown",function(e){var t=tinyMCE.activeEditor,n=t.selection.getNode();if(n.nodeName=="IMG"&&t.dom.hasClass(n,"TGSearchboxes")){t.dom.remove(n);t.execCommand("mceRepaint");return false}})},createControl:function(e,t){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};jQuery(document).ready(function(e){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)})
var tgsb_selBoxParam=false;var tgsb_images={"160x600":{url:TG_Searchboxes_Editor_Button.str_tgsb160x600,width:160,height:600,alignment:"alignnone"},"300x250":{url:TG_Searchboxes_Editor_Button.str_tgsb300x250,width:300,height:250,alignment:"alignnone"},"300x533":{url:TG_Searchboxes_Editor_Button.str_tgsb300x533,width:300,height:533,alignment:"alignnone"},"728x90":{url:TG_Searchboxes_Editor_Button.str_tgsb728x90,width:728,height:90,alignment:"alignnone"},dynamic:{url:TG_Searchboxes_Editor_Button.str_tgsbdynamic,width:628,height:250,alignment:"alignnone"}};function tgsbFromAir(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbFromAir"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.from_air){returnValue='"from_air":"'+c.value+'"';return}}});return returnValue}function tgsbToAir(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbToAir"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.to_air){returnValue='"to_air":"'+c.value+'"';return}}});return returnValue}function tgsbDepartureDate(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbDepartureDate"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.departure_date){returnValue='"departure_date":"'+c.value+'"';return}}});return returnValue}function tgsbReturnDate(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbReturnDate"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.return_date){returnValue='"return_date":"'+c.value+'"';return}}});return returnValue}function tgsbAdults(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbAdults"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.adults){returnValue='"adults":"'+c.value+'"';return}}});return returnValue}function tgsbKids(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbKids"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.kids){returnValue='"kids":"'+c.value+'"';return}}});return returnValue}function tgsbSeniors(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbSeniors"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.seniors){returnValue='"seniors":"'+c.value+'"';return}}});return returnValue}function tgsbRooms(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="tgsbRooms"){if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rooms){returnValue='"rooms":"'+c.value+'"';return}}});return returnValue}function tgsbRTOW(a){if(typeof(a)=="undefined"||a.length==0){return""}returnValue="";jQuery.each(a,function(b,c){if(c.name=="oneway"){c.value=(c.value=="on")?true:false;if(c.value!=TG_Searchboxes_Variables.tgsbDefaultSettings.rtow){returnValue='"rtow":"'+c.value+'"';return}}});return returnValue}function setAlignment(){var b="alignnone";var a=jQuery("#TB_ajaxContent").find("input[name=img_align]");for(i in a){if(a[i].checked==true){b=a[i].value;break}}return b}var tgsb_popupInitOpt={init:function(ed,url){var t=this;t.url=url;t._createButtons();ed.addCommand("mceTGSearchboxesInsert",function(){tg_searchboxes_tinymce_button_click(t)});ed.addButton("TGSearchboxes",{title:TG_Searchboxes_Editor_Button.str_EditorButtonTitle,cmd:"mceTGSearchboxesInsert",image:url+"/../images/tg20x20.gif"});ed.onNodeChange.add(function(ed,cm,n){cm.setActive("TGSearchboxes",n.nodeName=="IMG")});ed.onMouseDown.add(function(ed,e){if((e.target&&e.target.nodeName=="IMG"&&ed.dom.hasClass(e.target,"TGSearchboxes"))||(e.target&&e.target.firstChild&&e.target.firstChild.nodeName=="IMG"&&ed.dom.hasClass(e.target.firstChild,"TGSearchboxes"))){tgsb_selBoxParam=t.getAttr(e.target.title,"options");try{tgsb_selBoxParam=eval("("+tgsb_selBoxParam+")")}catch(tgsb_err){tgsb_selBoxParam={size:"300x250",selectedTab:"flights"}}ed.plugins.wordpress._showButtons(e.target,"wp_gallerybtns")}else{tgsb_selBoxParam=false}});ed.onBeforeSetContent.add(function(ed,o){o.content=t._do_tg_searchboxes(o.content)});ed.onPostProcess.add(function(ed,o){if(o.get){o.content=t._get_tg_searchboxes(o.content);if(typeof(tgsb_selBoxParam)!="undefined"&&tgsb_selBoxParam){tgsb_selBoxParam=false}}})},getAttr:function(b,c){var a=new RegExp(c+'="([^"]+)"',"g").exec(b);if(a){return tinymce.DOM.decode(a[1])}a=new RegExp(c+"='([^']+)'","g").exec(b);if(a){return tinymce.DOM.decode(a[1])}return""},_get_tg_searchboxes:function(a){return a.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(d,c){var b=tgsb_popupInitOpt.getAttr(c,"class");if(b.indexOf("TGSearchboxes")!=-1){return"<p>["+tinymce.trim(tgsb_popupInitOpt.getAttr(c,"title"))+"]</p>"}return d})},_do_tg_searchboxes:function(co){return co.replace(/\[tg_searchboxes([^\]]*)\]/g,function(a,b){var options=tgsb_popupInitOpt.getAttr(a,"options");var tgSearchboxSize="300x250";var tgsbImageUrl="";var tgsbImageWidth=300;var tgsbImageHeight=250;if(options.length){try{options=eval("("+options+")")}catch(tgsb_err){options=""}if(typeof(options.size)!="undefined"){tgSearchboxSize=options.size}}tgsbImageUrl=tgsb_images[tgSearchboxSize].url;tgsbImageWidth=tgsb_images[tgSearchboxSize].width;tgsbImageHeight=tgsb_images[tgSearchboxSize].height;tgsbImageAlign=(typeof(options.alignment)=="undefined")?tgsb_images[tgSearchboxSize].alignment:options.alignment;return'<img src="'+tinymce.baseURL+'/plugins/wpgallery/img/t.gif" class="TGSearchboxes mceItem '+tgsbImageAlign+'" style="background-image:url('+tgsbImageUrl+");background-repeat:no-repeat;width:"+tgsbImageWidth+"px;height:"+tgsbImageHeight+'px;padding:0" title="tg_searchboxes'+tinymce.DOM.encode(b)+'"/>'})},_createButtons:function(){var b=this,a=tinyMCE.activeEditor,d=tinymce.DOM,e,c;d.remove("wp_gallerybtns");d.add(document.body,"div",{id:"wp_gallerybtns",style:"display:none;"});e=d.add("wp_gallerybtns","img",{src:b.url+"/img/edit.png",id:"wp_editgallery",width:"24",height:"24",title:"Edit Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(e,"mousedown",function(h){var f=tinyMCE.activeEditor,g=f.selection.getNode();if(g.nodeName=="IMG"&&f.dom.hasClass(g,"TGSearchboxes")){f.windowManager.bookmark=f.selection.getBookmark("simple");f.execCommand("mceTGSearchboxesInsert")}});c=d.add("wp_gallerybtns","img",{src:b.url+"/img/delete.png",id:"wp_delgallery",width:"24",height:"24",title:"Delete Searchbox"});(tinymce.dom.Event.bind?tinymce.dom.Event.bind:tinymce.dom.Event.add)(c,"mousedown",function(h){var f=tinyMCE.activeEditor,g=f.selection.getNode();if(g.nodeName=="IMG"&&f.dom.hasClass(g,"TGSearchboxes")){f.dom.remove(g);f.execCommand("mceRepaint");return false}})},createControl:function(b,a){return null},getInfo:function(){return{longname:"Travelgrove Searchboxes",author:"Travelgrove.com",authorurl:"http://www.travelgrove.com/",infourl:"http://www.travelgrove.com/",version:"1.0"}}};function tg_searchboxes_tinymce_button_click(a){var c="Travelgrove Searchboxes";var b=TG_Searchboxes_Editor_Button.str_EditorButtonAjaxURL.replace(/\&amp\;/ig,"&");tb_show(c,b,false);jQuery("#TB_ajaxContent").width("auto").height("94.5%").click(function(j){var e=jQuery(j.target);if(e.is("a.send_searchbox_to_editor")||e.is("input.send_searchbox_to_editor")){var l=jQuery("ul.measuresChooser li a.current").text();l=(l.length==0)?"300x250":l;var f=jQuery(".sb"+l+" .tg_searchbox .tg_container").find("form.sel").attr("class").match(/^(flights|hotels|cars|packages)/);var d=jQuery(".sb"+l+" .tg_searchbox .tg_container form").serializeArray();var h=jQuery("#travelSearchUseJavaScript").attr("checked");var k="";tgsb_fromAir=tgsbFromAir(d);k+=(tgsb_fromAir.length)?tgsb_fromAir+",":tgsb_fromAir;tgsb_toAir=tgsbToAir(d);k+=(tgsb_toAir.length)?tgsb_toAir+",":tgsb_toAir;tgsb_departureDate=tgsbDepartureDate(d);k+=(tgsb_departureDate.length)?tgsb_departureDate+",":tgsb_departureDate;tgsb_returnDate=tgsbReturnDate(d);k+=(tgsb_returnDate.length)?tgsb_returnDate+",":tgsb_returnDate;tgsb_adults=tgsbAdults(d);k+=(tgsb_adults.length)?tgsb_adults+",":tgsb_adults;tgsb_kids=tgsbKids(d);k+=(tgsb_kids.length)?tgsb_kids+",":tgsb_kids;tgsb_seniors=tgsbSeniors(d);k+=(tgsb_seniors.length)?tgsb_seniors+",":tgsb_seniors;tgsb_rooms=tgsbRooms(d);k+=(tgsb_rooms.length)?tgsb_rooms+",":tgsb_rooms;tgsb_rtow=tgsbRTOW(d);k+=(tgsb_rtow.length)?tgsb_rtow+",":tgsb_rtow;k+=h?'"usejavascript":"on",':"";k+=(l=="300x250")?"":'"size":"'+l+'",';k+=(f==null)?'"selectedTab":"flights",':((f[1]=="flights")?"":'"selectedTab":"'+f[1]+'",');alignment=setAlignment();k+=(alignment=="alignnone")?"":'"alignment":"'+alignment+'"';if(k.match(/\,$/)){k=k.replace(/\,$/,"")}var g="[tg_searchboxes"+(k.length?" options='{"+k+"}']":"]");g=a._do_tg_searchboxes(g);tinyMCE.execCommand("mceInsertContent",0,g);if(typeof(tgsb_selBoxParam)!="undefined"&&tgsb_selBoxParam){tgsb_selBoxParam=false}tb_remove();return false}return false});return false}jQuery(document).ready(function(a){tinymce.create("tinymce.plugins.TGSearchboxes",tgsb_popupInitOpt);tinymce.PluginManager.add("TGSearchboxes",tinymce.plugins.TGSearchboxes)});